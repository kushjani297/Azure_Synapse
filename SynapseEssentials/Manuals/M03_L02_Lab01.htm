<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=Generator content="Microsoft Word 15 (filtered)">
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:DengXian;
	panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
@font-face
	{font-family:Cambria;
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:"Segoe UI";
	panose-1:2 11 5 2 4 2 4 2 2 3;}
@font-face
	{font-family:Tahoma;
	panose-1:2 11 6 4 3 5 4 4 2 4;}
@font-face
	{font-family:Consolas;
	panose-1:2 11 6 9 2 2 4 3 2 4;}
@font-face
	{font-family:"\@DengXian";
	panose-1:2 1 6 0 3 1 1 1 1 1;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:10.0pt;
	margin-left:0in;
	line-height:115%;
	font-size:11.0pt;
	font-family:"Cambria",serif;}
h2
	{mso-style-link:"Heading 2 Char";
	margin-top:24.0pt;
	margin-right:.1in;
	margin-bottom:12.0pt;
	margin-left:0in;
	page-break-before:always;
	page-break-after:avoid;
	font-size:20.0pt;
	font-family:"Segoe UI",sans-serif;
	color:#4F81BD;
	font-weight:normal;}
h3
	{mso-style-link:"Heading 3 Char";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:12.0pt;
	margin-left:0in;
	line-height:115%;
	page-break-after:avoid;
	font-size:16.0pt;
	font-family:"Segoe UI",sans-serif;
	color:black;}
p.MsoToc2, li.MsoToc2, div.MsoToc2
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:5.0pt;
	margin-left:11.0pt;
	line-height:115%;
	font-size:11.0pt;
	font-family:"Cambria",serif;}
p.MsoToc3, li.MsoToc3, div.MsoToc3
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:5.0pt;
	margin-left:58.0pt;
	text-indent:-.25in;
	line-height:115%;
	font-size:11.0pt;
	font-family:"Cambria",serif;}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;}
p.MsoNoSpacing, li.MsoNoSpacing, div.MsoNoSpacing
	{mso-style-link:"No Spacing Char";
	margin:0in;
	font-size:11.0pt;
	font-family:"Cambria",serif;}
p.MsoListParagraph, li.MsoListParagraph, div.MsoListParagraph
	{mso-style-name:"List Paragraph\,Bullet List\,FooterText\,Procedure StepCxSpLast";
	mso-style-link:"List Paragraph Char\,Bullet List Char\,FooterText Char\,Procedure StepCxSpLast Char";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:10.0pt;
	margin-left:.5in;
	line-height:115%;
	font-size:11.0pt;
	font-family:"Cambria",serif;}
p.MsoTocHeading, li.MsoTocHeading, div.MsoTocHeading
	{margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	font-size:14.0pt;
	font-family:"Segoe UI",sans-serif;
	color:#365F91;
	font-weight:bold;}
span.Heading2Char
	{mso-style-name:"Heading 2 Char";
	mso-style-link:"Heading 2";
	font-family:"Segoe UI",sans-serif;
	color:#4F81BD;}
span.Heading3Char
	{mso-style-name:"Heading 3 Char";
	mso-style-link:"Heading 3";
	font-family:"Segoe UI",sans-serif;
	color:black;
	font-weight:bold;}
span.ListParagraphChar
	{mso-style-name:"List Paragraph Char\,Bullet List Char\,FooterText Char\,Procedure StepCxSpLast Char";
	mso-style-link:"List Paragraph\,Bullet List\,FooterText\,Procedure StepCxSpLast";
	font-family:"Cambria",serif;}
span.TaskHeadingChar
	{mso-style-name:"Task Heading Char";
	mso-style-link:"Task Heading";
	font-family:"Segoe UI",sans-serif;
	font-weight:bold;}
p.TaskHeading, li.TaskHeading, div.TaskHeading
	{mso-style-name:"Task Heading";
	mso-style-link:"Task Heading Char";
	margin-top:0in;
	margin-right:.1in;
	margin-bottom:3.0pt;
	margin-left:0in;
	line-height:115%;
	page-break-after:avoid;
	font-size:14.0pt;
	font-family:"Segoe UI",sans-serif;
	font-weight:bold;}
span.TaskDetailChar
	{mso-style-name:"Task Detail Char";
	mso-style-link:"Task Detail";
	font-family:"Cambria",serif;
	color:black;
	font-weight:normal;}
p.TaskDetail, li.TaskDetail, div.TaskDetail
	{mso-style-name:"Task Detail";
	mso-style-link:"Task Detail Char";
	margin-top:0in;
	margin-right:.1in;
	margin-bottom:6.0pt;
	margin-left:67.5pt;
	line-height:115%;
	font-size:11.0pt;
	font-family:"Cambria",serif;
	color:black;}
span.ExerciseScenerioChar
	{mso-style-name:"Exercise Scenerio Char";
	mso-style-link:"Exercise Scenerio";
	font-family:"Cambria",serif;}
p.ExerciseScenerio, li.ExerciseScenerio, div.ExerciseScenerio
	{mso-style-name:"Exercise Scenerio";
	mso-style-link:"Exercise Scenerio Char";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:10.0pt;
	margin-left:0in;
	line-height:115%;
	font-size:11.0pt;
	font-family:"Cambria",serif;}
span.NoSpacingChar
	{mso-style-name:"No Spacing Char";
	mso-style-link:"No Spacing";
	font-family:"Cambria",serif;}
.MsoChpDefault
	{font-size:10.0pt;
	font-family:"Calibri",sans-serif;}
.MsoPapDefault
	{margin-bottom:10.0pt;
	line-height:115%;}
 /* Page Definitions */
 @page WordSection1
	{size:8.5in 11.0in;
	margin:1.0in 1.0in 1.0in 1.0in;
	border:double windowtext 5.25pt;
	padding:24.0pt 24.0pt 24.0pt 24.0pt;}
div.WordSection1
	{page:WordSection1;}
 /* List Definitions */
 ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
-->
</style>

</head>

<body lang=EN-US link=blue vlink=purple style='word-wrap:break-word'>

<div class=WordSection1>

<p class=MsoNormal align=center style='text-align:center'><img width=624
height=226 id="Picture 13" src="M03_L02_Lab01_files/image001.png"></p>

<p class=MsoNormal align=center style='text-align:center'><b><span
style='font-size:22.0pt;line-height:115%'>Designing for Performance in </span></b></p>

<p class=MsoNormal align=center style='text-align:center'><b><span
style='font-size:22.0pt;line-height:115%'>Azure Synapse SQL Pool</span></b></p>

<p class=MsoNormal><b>Introduction</b></p>

<p class=MsoNormal>In this lab, you will work through the different table
indexing options, Views and Materialized Views available in Synapse SQL Pool. </p>

<p class=MsoNormal><b>Estimated Time</b></p>

<p class=MsoNormal>60 minutes</p>

<p class=MsoNormal><b>Objectives</b></p>

<p class=MsoNormal>Upon completing this lab, you will be able to: </p>

<p class=MsoListParagraph style='margin-left:39.0pt;text-indent:-21.0pt'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>Create different tables in Synapse SQL</p>

<p class=MsoListParagraph style='margin-left:39.0pt;text-indent:-21.0pt'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>Understand data distribution</p>

<p class=MsoListParagraph style='margin-left:39.0pt;text-indent:-21.0pt'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>Understand the performance difference between table types</p>

<p class=MsoListParagraph style='margin-left:39.0pt;text-indent:-21.0pt'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>Understand how Views are used, and the benefits of encapsulating
business logic in well-designed views</p>

<p class=MsoListParagraph style='margin-left:39.0pt;text-indent:-21.0pt'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>Understand the concepts of Materialized Views</p>

<b><span style='font-size:11.0pt;line-height:115%;font-family:"Cambria",serif'><br
clear=all style='page-break-before:always'>
</span></b>

<p class=MsoNormal><b>&nbsp;</b></p>

<p class=MsoNormal><b>Prerequisites</b></p>

<p class=MsoListParagraph style='margin-left:.25in;text-indent:-.25in'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>An Azure Synapse SQL (created in the Create and Provision Lab).</p>

<p class=MsoListParagraph style='margin-left:.25in;text-indent:-.25in'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>Supported operating System to perform this class: Windows
10/Windows Server 2016</p>

<p class=MsoListParagraph style='margin-left:.25in;text-indent:-.25in'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>Visual Studio 2017 or later (preferred option) or SQL Server
Management Studio 2017 or later.</p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoListParagraph style='margin-left:.25in'><span style='font-size:
10.0pt;line-height:115%'>&nbsp;</span></p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#D9E2F3'>

<p class=MsoNormal style='background:#D9E2F3;border:none;padding:0in'><b><span
style='color:black'>Note: </span></b><span style='color:black'>The labs can be
performed using your laptop environment rather than LOD environment.</span></p>

</div>

<p class=MsoNormal><b><span style='color:black'>&nbsp;</span></b></p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#D9E2F3'>

<p class=MsoNormal style='background:#D9E2F3;border:none;padding:0in'><b><span
style='color:black'>Note:</span></b><span style='color:black'> This lab expects
you to review the output from some of the queries and draw conclusions or
explain what you see. <i>The questions for you to answer are in italics.</i></span><span
style='color:black'> </span><span style='color:black'>  </span><span
style='color:black'>Please note your answers, so we can go through them at the
end of the lab.</span></p>

</div>

<span style='font-size:11.0pt;line-height:115%;font-family:"Cambria",serif'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoTocHeading>Table of Contents</p>

<p class=MsoToc2><a href="#_Toc46668410">Lab: Designing for Performance in
Synapse SQL<span style='color:windowtext;display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>4</span></a></p>

<p class=MsoToc3 style='text-indent:-58.0pt'><span style='font-family:"Calibri",sans-serif'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>i.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><a href="#_Toc46668411">Preparation<span style='color:windowtext;
display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>5</span></a></p>

<p class=MsoToc3 style='text-indent:-58.0pt'><span style='font-family:"Calibri",sans-serif'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>ii.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><a href="#_Toc46668412">Exercise 1: Working with Clustered
ColumnStore Indexes<span style='color:windowtext;display:none;text-decoration:
none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>7</span></a></p>

<p class=MsoToc3 style='text-indent:-58.0pt'><span style='font-family:"Calibri",sans-serif'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>iii.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><a href="#_Toc46668413">Exercise 2: Views<span style='color:windowtext;
display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>10</span></a></p>

<p class=MsoToc3 style='text-indent:-58.0pt'><span style='font-family:"Calibri",sans-serif'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>iv.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><a href="#_Toc46668414">Exercise 3: Materialized Views<span
style='color:windowtext;display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>14</span></a></p>

<p class=MsoToc3 style='text-indent:-58.0pt'><span style='font-family:"Calibri",sans-serif'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>v.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><a href="#_Toc46668415">Answers<span style='color:windowtext;
display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>22</span></a></p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal> </p>

<p class=MsoNormal>&nbsp;</p>

<h2><a name="_Toc46668410"></a><a name="_Toc510003826">Lab</a>: Designing for
Performance in Synapse SQL</h2>

<p class=MsoNormal>In this lab, you will create multiple tables and understand
the impact on the query performance. </p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#BDD6EE'>

<p class=MsoNormal style='background:#BDD6EE;border:none;padding:0in'><b><span
style='color:black'>Important:</span></b><span style='color:black'> Please
ensure your Synapse SQL Pool data warehouse is running at DW500c before
proceeding with the preparation task. Please Resume and / or scale it up/down
if it is not running at DW1000 c.</span></p>

<p class=MsoNormal style='background:#BDD6EE;border:none;padding:0in'><span
style='color:black'>All SQL Script files for this Lab can be located in folder <b>LabFiles\Module3\M03L02Lab01.</b></span></p>

<p class=MsoNormal style='background:#BDD6EE;border:none;padding:0in'><span
style='color:black'>All SQL Script files for this Lab are named <b>“M03_L02_Lab01.*.sql”</b></span></p>

<p class=MsoNormal style='background:#BDD6EE;border:none;padding:0in'>&nbsp;</p>

</div>

<p class=MsoNormal>&nbsp;</p>

<b><span style='font-size:16.0pt;line-height:115%;font-family:"Segoe UI",sans-serif;
color:black'><br clear=all style='page-break-before:always'>
</span></b>

<h3>&nbsp;</h3>

<h3><a name="_Toc46668411">Preparation</a></h3>

<p class=MsoNormal>We need to load the NYCTaxi default dataset for this lab.</p>

<p class=MsoNormal>NYC Taxi data was loaded in the prep work for Lab 1 in this
module. If you don’t have the data loaded, please refer to that document to
load the data, we will also be using some of the tables created in that lab,
please work through Lab 1 if you haven’t done so already.</p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal><b><u>Tasks.</u></b></p>

<p class=MsoListParagraph style='text-indent:-.25in'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>In SSMS, connect to your Synapse SQL Pool.</p>

<p class=MsoListParagraph style='text-indent:-.25in'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Create the view vCCI_Stats_Detail.</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#BDD6EE;margin-left:.25in;margin-right:0in'>

<p class=MsoListParagraph style='margin-left:0in;background:#BDD6EE;border:
none;padding:0in'><span style='color:black'>Script file: <b>M03_L02_Lab01.Ex0_vCCI_Stats_Detail.sql</b></span></p>

</div>

<p class=MsoListParagraph>&nbsp;</p>

<p class=MsoListParagraph style='text-indent:-.25in'><b>3.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b>Create
the view vCCIHealth.</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#BDD6EE;margin-left:.25in;margin-right:0in'>

<p class=MsoListParagraph style='margin-left:0in;background:#BDD6EE;border:
none;padding:0in'><span style='color:black'>Script file: <b>M03_L02_Lab01.Ex0_vCCIHealth.sql</b></span></p>

</div>

<p class=MsoNormal style='margin-left:.25in'>&nbsp;</p>

<p class=MsoNormal>You will need Visual Studio, or an XML editor available in
one or more steps in this Lab.</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#BDD6EE'>

<p class=MsoNormal style='background:#BDD6EE;border:none;padding:0in'><span
style='color:black'>Note: Leave Visual Studio / SSMS open – you will be using
that throughout the Lab.</span></p>

</div>

<h3><span style='font-size:11.0pt;line-height:115%;font-family:"Cambria",serif'>&nbsp;</span></h3>

<b><span style='font-size:16.0pt;line-height:115%;font-family:"Segoe UI",sans-serif;
color:black'><br clear=all style='page-break-before:always'>
</span></b>

<h3>&nbsp;</h3>

<h3><a name="_Hlk46068073"></a><a name="_Toc46668412">Exercise 1: Working with
Clustered ColumnStore Indexes</a></h3>

<p class=MsoNormal>Clustered ColumnStore Indexes (referred to as CCI) are designed
to perform extremely well for DW type queries, with aggregations over large
datasets.</p>

<p class=MsoNormal>Performance benefits from large Compressed rowgroups, up to
1,048,5756 rows (2^20, this will be referred to as 1M* rows in this document).
Smaller rowgroups can negatively impact performance, as will deleted rows and
uncompressed rows.</p>

<p class=ExerciseScenerio>&nbsp;</p>

<p class=TaskHeading>Tasks</p>

<p class=MsoListParagraph style='text-indent:-.25in'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Examine the stats for table Trip_Medallion, the table we created in the
prior lab.</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#BDD6EE;margin-left:.25in;margin-right:0in'>

<p class=MsoListParagraph style='margin-left:0in;background:#BDD6EE;border:
none;padding:0in'><span style='color:black'>Script file: <b>M03_L02_Lab01.Ex1_Step1.sql</b></span></p>

</div>

<p class=MsoListParagraph>&nbsp;</p>

<p class=MsoListParagraph><img width=348 height=147
src="M03_L02_Lab01_files/image002.png"
alt="SELECT *&#13;&#10;FROM vCCI_Stats_Detail&#13;&#10;WHERE [logical_table_name] = 'Trip_MedallionID'&#13;&#10;ORDER BY physical_name, row_group_id&#13;&#10;&#13;&#10;SELECT *&#13;&#10;FROM vCCIHealth&#13;&#10;WHERE Table_Name = 'Trip_MedallionID'&#13;&#10;"></p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#BDD6EE;margin-left:.5in;margin-right:0in'>

<p class=MsoListParagraph style='margin-left:0in;background:#BDD6EE;border:
none;padding:0in'><span style='color:black'>Notice that all the rows are in
OPEN rowgroups, there are no Compressed RowGroups.</span></p>

</div>

<p class=MsoListParagraph>&nbsp;</p>

<p class=MsoListParagraph style='text-indent:-.25in'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Generate a larger dataset, on the Trip_MedallionID table. </p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#BDD6EE;margin-left:.25in;margin-right:0in'>

<p class=MsoNormal style='background:#BDD6EE;border:none;padding:0in'><span
style='color:black'>Script file: <b>M03_L02_Lab01.Ex1_Step2.sql</b></span></p>

</div>

<p class=MsoListParagraph>&nbsp;</p>

<p class=MsoListParagraph>This will take 1 - 2 minutes to run at DW1000c.</p>

<p class=MsoListParagraph><img width=195 height=75
src="M03_L02_Lab01_files/image003.png"
alt="INSERT [Trip_MedallionID]&#13;&#10;SELECT *&#13;&#10;FROM [Trip_MedallionID]&#13;&#10;GO 8&#13;&#10;&#13;&#10;"></p>

<p class=MsoListParagraph><i>What is the effect of adding data to the table in
smaller chunks?</i></p>

<p class=MsoListParagraph>&nbsp;</p>

<p class=MsoListParagraph style='text-indent:-.25in'>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Re-examine the stats for table Trip_MedallionID.</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#BDD6EE;margin-left:.25in;margin-right:0in'>

<p class=MsoListParagraph style='margin-left:0in;background:#BDD6EE;border:
none;padding:0in'><span style='color:black'>Script file: <b>M03_L02_Lab01.Ex1_Step3.sql</b></span></p>

</div>

<p class=MsoNormal style='margin-left:.25in'>&nbsp;</p>

<p class=MsoListParagraph><img width=348 height=147
src="M03_L02_Lab01_files/image002.png"
alt="SELECT *&#13;&#10;FROM vCCI_Stats_Detail&#13;&#10;WHERE [logical_table_name] = 'Trip_MedallionID'&#13;&#10;ORDER BY physical_name, row_group_id&#13;&#10;&#13;&#10;SELECT *&#13;&#10;FROM vCCIHealth&#13;&#10;WHERE Table_Name = 'Trip_MedallionID'&#13;&#10;&#13;&#10;"></p>

<p class=MsoListParagraph><i>What status’s do you see for the RowGroups?</i></p>

<p class=MsoListParagraph>&nbsp;</p>

<p class=MsoListParagraph style='text-indent:-.25in'>4.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b>REORGANIZE the CCI</b>, to compress the Closed Rowgroups, using the
code below<b>,</b> and re-examine the detailed statistics for table
Trip_MedallionID.</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#BDD6EE;margin-left:.25in;margin-right:0in'>

<p class=MsoListParagraph style='margin-left:0in;background:#BDD6EE;border:
none;padding:0in'><span style='color:black'>Script file:<b>
M03_L02_Lab01.Ex1_Step4.sql</b></span></p>

</div>

<p class=MsoListParagraph><img width=334 height=102
src="M03_L02_Lab01_files/image004.png"
alt="ALTER INDEX ALL ON Trip_MedallionID&#13;&#10;	REORGANIZE;&#13;&#10;&#13;&#10;SELECT *&#13;&#10;FROM vCCI_Stats_Detail&#13;&#10;WHERE Logical_Table_Name = 'Trip_MedallionID'&#13;&#10;&#13;&#10;"></p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#BDD6EE;margin-left:.5in;margin-right:0in'>

<p class=MsoListParagraph style='margin-left:0in;background:#BDD6EE;border:
none;padding:0in'><b><span style='color:black'>Note</span></b><span
style='color:black'>: All the RowGroups should now be Compressed or Open. You
may see some Tombstone RowGroups, these are old rowgroups, waiting to be
cleaned up.</span></p>

</div>

<p class=MsoListParagraph><img width=511 height=129 id="Picture 11"
src="M03_L02_Lab01_files/image005.jpg"
alt="A screenshot of a computer&#10;&#10;Description automatically generated"></p>

<p class=MsoListParagraph>&nbsp;</p>

<b><span style='font-size:11.0pt;line-height:115%;font-family:"Cambria",serif'><br
clear=all style='page-break-before:always'>
</span></b>

<p class=MsoListParagraph style='text-indent:-.25in'><b>5.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><b>&nbsp;</b></p>

<p class=MsoListParagraph style='text-indent:-.25in'>5.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><b>REBUILD the CCI</b>, using the code below, and re-examine the detailed
statistics for table Trip_Medallion.</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#BDD6EE;margin-left:.25in;margin-right:0in'>

<p class=MsoNormal style='background:#BDD6EE;border:none;padding:0in'><span
style='color:black'>Script file:<b> M03_L02_Lab01.Ex1_Step5.sql</b></span></p>

</div>

<p class=MsoNormal style='margin-left:.25in'>&nbsp;</p>

<p class=MsoListParagraph><img width=334 height=117
src="M03_L02_Lab01_files/image006.png"
alt="ALTER INDEX ALL ON Trip_MedallionID&#13;&#10;	REBUILD;&#13;&#10;&#13;&#10;SELECT *&#13;&#10;FROM vCCI_Stats_Detail&#13;&#10;WHERE Logical_Table_Name = 'Trip_MedallionID'&#13;&#10;"></p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#BDD6EE;margin-left:.5in;margin-right:0in'>

<p class=MsoListParagraph style='margin-left:0in;background:#BDD6EE;border:
none;padding:0in'><b><span style='color:black'>Note</span></b><span
style='color:black'>: All the RowGroups should now be Compressed. </span></p>

</div>

<p class=MsoListParagraph>Half of the RowGroups have a Trim Reason of “RESIDUAL_ROW_GROUP”,
these are the rows left over from filling the RowGroups. The full RowGroups are
those with status “NO_TRIM”.</p>

<p class=MsoListParagraph><img width=543 height=127 id="Picture 12"
src="M03_L02_Lab01_files/image007.jpg"
alt="A screenshot of a computer&#10;&#10;Description automatically generated"><br>
<br>
</p>

<p class=MsoListParagraph>&nbsp;</p>

<span style='font-size:11.0pt;line-height:115%;font-family:"Cambria",serif'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoListParagraph style='text-indent:-.25in'>6.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>&nbsp;</p>

<p class=MsoListParagraph style='text-indent:-.25in'>6.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Copy the expanded Trip_MedallionID table, into a Partitioned table;
Hashed on MedallionID and Partitioned on DateID. </p>

<p class=MsoListParagraph>Examine the CCI Health for table Trip_Part.</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#BDD6EE;margin-left:.25in;margin-right:0in'>

<p class=MsoNormal style='background:#BDD6EE;border:none;padding:0in'><span
style='color:black'>Script file:<b> M03_L02_Lab01.Ex1_Step6.sql</b></span></p>

</div>

<p class=MsoListParagraph><img width=418 height=345
src="M03_L02_Lab01_files/image008.png"
alt="IF object_id('Trip_Part') IS NOT NULL DROP VIEW Trip_Part&#13;&#10;GO&#13;&#10;&#13;&#10;CREATE TABLE [dbo].[Trip_Part]&#13;&#10;WITH &#13;&#10;(	DISTRIBUTION = HASH ( [MedallionID] ),&#13;&#10;	CLUSTERED COLUMNSTORE INDEX,  PARTITION (&#13;&#10;    [DateID] RANGE RIGHT FOR &#13;&#10;    VALUES &#13;&#10;      ( 20130101, 20130201, 20130301, 20130401, &#13;&#10;        20130501, 20130601, 20130701, 20130801, &#13;&#10;        20130901, 20131001, 20131101, 20131201 )  )&#13;&#10;) &#13;&#10;AS &#13;&#10;SELECT *&#13;&#10;FROM [dbo].[Trip_MedallionID];&#13;&#10;&#13;&#10;&#13;&#10;SELECT *&#13;&#10;FROM vCCIHealth&#13;&#10;WHERE Table_Name = 'Trip_Part'&#13;&#10;&#13;&#10;"></p>

<p class=MsoListParagraph>&nbsp;</p>

<p class=MsoListParagraph><i>How many Open rowgroups are there?</i></p>

<p class=MsoListParagraph><i>What is the average rows per RowGroup? Is this
good or bad for performance?</i></p>

<p class=MsoListParagraph><i>For this dataset, is partitioning on DateID a good
idea?  </i></p>

<p class=MsoNormal>&nbsp;</p>

<span style='font-size:11.0pt;line-height:115%;font-family:"Cambria",serif'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoNormal><b><span style='font-size:16.0pt;line-height:115%;
font-family:"Segoe UI",sans-serif;color:black'>&nbsp;</span></b></p>

<h3><a name="_Toc46668414">Exercise 2: Materialized Views</a> </h3>

<p class=TaskHeading>Tasks</p>

<p class=MsoListParagraph style='text-indent:-.25in'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Execute this query in Visual Studio.</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#BDD6EE;margin-left:.25in;margin-right:0in'>

<p class=MsoNormal style='background:#BDD6EE;border:none;padding:0in'><span
style='color:black'>Script file:<b> M03_L02_Lab01.Ex2_Step1.sql</b></span></p>

</div>

<p class=MsoListParagraph>We will look at the stats for this query in the next
step.</p>

<p class=MsoListParagraph><img width=523 height=347
src="M03_L02_Lab01_files/image009.png"
alt="SET RESULT_SET_CACHING OFF&#13;&#10;GO&#13;&#10;&#13;&#10;SELECT c.*&#13;&#10;FROM&#13;&#10;    (SELECT b.County,&#13;&#10;            b.city,&#13;&#10;            count(a.dateid) AS total_trips,&#13;&#10;            rank() OVER (PARTITION BY b.county&#13;&#10;                        ORDER BY count(a.dateid) DESC) AS rank&#13;&#10;    FROM dbo.Trip a&#13;&#10;    LEFT JOIN dbo.Geography b ON a.[PickupGeographyID] = b.[GeographyID]&#13;&#10;    WHERE [State] = 'NY'&#13;&#10;    GROUP BY b.County,&#13;&#10;            b.city) c&#13;&#10;WHERE rank &lt;=3&#13;&#10;    AND total_trips &gt; 100&#13;&#10;ORDER BY County,&#13;&#10;            City,&#13;&#10;            total_trips,&#13;&#10;            rank&#13;&#10;OPTION (Label = 'MV Candidate Query')&#13;&#10;&#13;&#10;"></p>

<p class=MsoNormal>Note that we set the RESULT_SET_CACHING to OFF for the
session. We don’t want the query to get the resultset from the cache – that
would prevent the lab from providing us with any meaningful results.</p>

<span style='font-size:11.0pt;line-height:115%;font-family:"Cambria",serif'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoListParagraph style='text-indent:-.25in'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Execute this query, to capture the steps that are executed in step 1.</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#BDD6EE;margin-left:.25in;margin-right:0in'>

<p class=MsoNormal style='background:#BDD6EE;border:none;padding:0in'><span
style='color:black'>Script file:<b> M03_L02_Lab01.Ex2_Step2.sql</b></span></p>

</div>

<p class=MsoListParagraph>&nbsp;</p>

<p class=MsoListParagraph><img width=749 height=305
src="M03_L02_Lab01_files/image010.png"
alt="DECLARE @Label		VARCHAR(64) = 'MV Candidate Query' -- The label value from the previous query&#13;&#10;&#13;&#10;DECLARE @QID		VARCHAR(64)&#13;&#10;SELECT @QID = MAX(request_id)&#13;&#10;FROM sys.dm_pdw_exec_requests er&#13;&#10;WHERE er.[label] = @Label &#13;&#10; AND  er.[command] NOT LIKE '%sys.dm_pdw_exec_requests%' -- Dont return this query&#13;&#10;&#13;&#10;-- EXEC_REQUESTS&#13;&#10;SELECT *&#13;&#10;FROM sys.dm_pdw_exec_requests&#13;&#10;WHERE request_id = @QID&#13;&#10;&#13;&#10;-- REQUEST_STEPS&#13;&#10;SELECT *&#13;&#10;FROM sys.dm_pdw_request_steps&#13;&#10;WHERE request_id = @QID&#13;&#10;&#13;&#10;"></p>

<p class=MsoListParagraph>&nbsp;</p>

<p class=MsoListParagraph style='text-indent:-.25in'>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>The output includes multiple steps and moves.</p>

<p class=MsoNormal><img width=627 height=284 id="Picture 7"
src="M03_L02_Lab01_files/image011.jpg"></p>

<span style='font-size:11.0pt;line-height:115%;font-family:"Cambria",serif'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoNormal style='margin-left:.25in'>&nbsp;</p>

<p class=MsoNormal style='margin-left:.25in'>&nbsp;</p>

<p class=MsoListParagraph style='text-indent:-.25in'>4.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>In <b>Visual Studio</b>, execute the query with <b>EXPLAIN
WITH_RECOMMENDATIONS.</b>.</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#BDD6EE;margin-left:.25in;margin-right:0in'>

<p class=MsoNormal style='background:#BDD6EE;border:none;padding:0in'><span
style='color:black'>Script file:<b> M03_L02_Lab01.Ex2_Step4.sql</b></span></p>

</div>

<p class=MsoListParagraph><img width=523 height=323
src="M03_L02_Lab01_files/image012.png"
alt="EXPLAIN WITH_RECOMMENDATIONS&#13;&#10;SELECT c.*&#13;&#10;FROM&#13;&#10;    (SELECT b.County,&#13;&#10;            b.city,&#13;&#10;            count(a.dateid) AS total_trips,&#13;&#10;            rank() OVER (PARTITION BY b.county&#13;&#10;                        ORDER BY count(a.dateid) DESC) AS rank&#13;&#10;    FROM dbo.Trip a&#13;&#10;    LEFT JOIN dbo.Geography b ON a.[PickupGeographyID] = b.[GeographyID]&#13;&#10;    WHERE [State] = 'NY'&#13;&#10;    GROUP BY b.County,&#13;&#10;            b.city) c&#13;&#10;WHERE rank &lt;=3&#13;&#10;    AND total_trips &gt; 100&#13;&#10;ORDER BY County,&#13;&#10;            City,&#13;&#10;            total_trips,&#13;&#10;            rank&#13;&#10;OPTION (Label = 'MV Candidate Query')&#13;&#10;&#13;&#10;">.</p>

<p class=MsoListParagraph>The output from the EXPLAIN WITH_RECOMMENDATIONS is
generated as an XML, click on the hyperlink to open the XML file.</p>

<span style='font-size:11.0pt;line-height:115%;font-family:"Cambria",serif'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoListParagraph>&nbsp;</p>

<p class=MsoListParagraph>The top of the XMl file will show candidate
Materialized Views:</p>

<p class=MsoListParagraph><img width=899 height=461
src="M03_L02_Lab01_files/image013.png"
alt="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#13;&#10;&lt;dsql_query number_nodes=&quot;1&quot; number_distributions=&quot;60&quot; number_distributions_per_node=&quot;60&quot;&gt;&#13;&#10;  &lt;sql&gt;…sql&gt;&#13;&#10;  &lt;materialized_view_candidates&gt;&#13;&#10;    &lt;materialized_view_candidates with_constants=&quot;False&quot;&gt;CREATE MATERIALIZED VIEW View1 WITH (DISTRIBUTION = HASH([Expr0])) AS&#13;&#10;SELECT [b].[County] AS [Expr0],&#13;&#10;       [b].[City] AS [Expr1],&#13;&#10;       [b].[State] AS [Expr2],&#13;&#10;       COUNT(*) AS [Expr3]&#13;&#10;FROM [dbo].[Trip],&#13;&#10;     [dbo].[Geography]&#13;&#10;WHERE [b].[GeographyID]=[a].[PickupGeographyID]&#13;&#10;GROUP BY [b].[County],&#13;&#10;         [b].[City],&#13;&#10;         [b].[State]&lt;/materialized_view_candidates&gt;&#13;&#10;    &lt;materialized_view_candidates with_constants=&quot;True&quot;&gt;CREATE MATERIALIZED VIEW View2 WITH (DISTRIBUTION = HASH([Expr0])) AS&#13;&#10;SELECT [b].[County] AS [Expr0],&#13;&#10;       [b].[City] AS [Expr1],&#13;&#10;       COUNT(*) AS [Expr2]&#13;&#10;FROM [dbo].[Trip],&#13;&#10;     [dbo].[Geography]&#13;&#10;WHERE ([b].[GeographyID]=[a].[PickupGeographyID])&#13;&#10;  AND ([b].[State]='NY')&#13;&#10;GROUP BY [b].[County],&#13;&#10;         [b].[City]&lt;/materialized_view_candidates&gt;&#13;&#10;  &lt;/materialized_view_candidates&gt;&#13;&#10;"></p>

<p class=MsoListParagraph>In this case, 2 candidates are reported.</p>

<span style='font-size:11.0pt;line-height:115%;font-family:"Cambria",serif'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoListParagraph>&nbsp;</p>

<p class=MsoListParagraph>&nbsp;</p>

<p class=MsoListParagraph style='text-indent:-.25in'>5.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Copy the first MV Candidate from the XML. Paste this into a Query
window, Rename the view as ‘<span style='font-size:9.5pt;line-height:115%;
font-family:Consolas;color:black'>mv_TripGeography’ </span>and add aliases to
the tables , so you code looks like this.</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#BDD6EE;margin-left:.25in;margin-right:0in'>

<p class=MsoNormal style='background:#BDD6EE;border:none;padding:0in'><span
style='color:black'>Script file:<b> M03_L02_Lab01.Ex2_Step5.sql</b></span></p>

</div>

<p class=MsoNormal style='margin-left:.25in'>&nbsp;</p>

<p class=MsoListParagraph><img width=348 height=198
src="M03_L02_Lab01_files/image014.png"
alt="CREATE MATERIALIZED VIEW mv_TripGeography &#13;&#10;WITH (DISTRIBUTION = HASH(County)) AS&#13;&#10;SELECT [b].[County],&#13;&#10;       [b].[City] ,&#13;&#10;       [b].[State],&#13;&#10;       COUNT(*) AS [Expr3]&#13;&#10;FROM [dbo].[Trip] a,&#13;&#10;     [dbo].[Geography] b&#13;&#10;WHERE [b].[GeographyID]=[a].[PickupGeographyID]&#13;&#10;GROUP BY [b].[County],&#13;&#10;         [b].[City],&#13;&#10;         [b].[State]&#13;&#10;&#13;&#10;"></p>

<p class=MsoListParagraph>Execute the code to create the Materialized view.</p>

<p class=MsoListParagraph>&nbsp;</p>

<p class=MsoListParagraph style='text-indent:-.25in'>6.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Re-execute the query from step 1 above.</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#BDD6EE;margin-left:.25in;margin-right:0in'>

<p class=MsoNormal style='background:#BDD6EE;border:none;padding:0in'><span
style='color:black'>Script file:<b> M03_L02_Lab01.Ex2_Step6.sql</b></span></p>

</div>

<p class=MsoListParagraph><img width=523 height=347
src="M03_L02_Lab01_files/image015.png"
alt="SET RESULT_SET_CACHING OFF&#13;&#10;GO&#13;&#10;&#13;&#10;SELECT c.*&#13;&#10;FROM&#13;&#10;    (SELECT b.County,&#13;&#10;            b.city,&#13;&#10;            count(a.dateid) AS total_trips,&#13;&#10;            rank() OVER (PARTITION BY b.county&#13;&#10;                        ORDER BY count(a.dateid) DESC) AS rank&#13;&#10;    FROM dbo.Trip a&#13;&#10;    LEFT JOIN dbo.Geography b ON a.[PickupGeographyID] = b.[GeographyID]&#13;&#10;    WHERE [State] = 'NY'&#13;&#10;    GROUP BY b.County,&#13;&#10;            b.city) c&#13;&#10;WHERE rank &lt;=3&#13;&#10;    AND total_trips &gt; 100&#13;&#10;ORDER BY County,&#13;&#10;            City,&#13;&#10;            total_trips,&#13;&#10;            rank&#13;&#10;OPTION (Label = 'MV Query')&#13;&#10;&#13;&#10;"></p>

<p class=MsoListParagraph style='text-indent:-.25in'>7.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Execute the query from step 2 above, to capture the steps that are
executed.</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#BDD6EE;margin-left:.25in;margin-right:0in'>

<p class=MsoNormal style='background:#BDD6EE;border:none;padding:0in'><span
style='color:black'>Script file:<b> M03_L02_Lab01.Ex2_Step7.sql</b></span></p>

</div>

<p class=MsoListParagraph><img width=680 height=316
src="M03_L02_Lab01_files/image016.png"
alt="DECLARE @Label		VARCHAR(64) = 'MV Query' -- The label value from the previous query&#13;&#10;&#13;&#10;DECLARE @QID		VARCHAR(64)&#13;&#10;SELECT @QID = MAX(request_id)&#13;&#10;FROM sys.dm_pdw_exec_requests er&#13;&#10;WHERE er.[label] = @Label &#13;&#10; AND  er.[command] NOT LIKE '%sys.dm_pdw_exec_requests%' -- Dont return this query&#13;&#10;&#13;&#10;-- EXEC_REQUESTS&#13;&#10;SELECT *&#13;&#10;FROM sys.dm_pdw_exec_requests&#13;&#10;WHERE request_id = @QID&#13;&#10;&#13;&#10;-- REQUEST_STEPS&#13;&#10;SELECT *&#13;&#10;FROM sys.dm_pdw_request_steps&#13;&#10;WHERE request_id = @QID&#13;&#10;"></p>

<p class=MsoNormal>Note that the query just executes a simple RETURN step, all
the DATA moves are now abstracted into the Materialized View.<br clear=all
style='page-break-before:always'>
</p>

<p class=MsoListParagraph>&nbsp;</p>

<p class=MsoListParagraph style='text-indent:-.25in'>8.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>The output includes only 1 step, simple retrieval from the MV.:</p>

<p class=MsoListParagraph><img width=624 height=70 id="Picture 48"
src="M03_L02_Lab01_files/image017.jpg"></p>

<p class=MsoListParagraph>&nbsp;</p>

<p class=MsoListParagraph>&nbsp;</p>

<p class=MsoListParagraph>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#BDD6EE;margin-left:0in;margin-right:.1in'>

<p class=TaskDetail style='margin-top:0in;margin-right:0in;margin-bottom:6.0pt;
margin-left:0in;background:#BDD6EE;border:none;padding:0in'><b>Important:</b>
Please pause your Synapse SQL Pool upon completing this lab. Do resume the SQL
Pool when you start working with the exercises. This is to prevent from
reaching the credit limit throughout the workshop.</p>

<span style='font-size:11.0pt;line-height:115%;font-family:"Cambria",serif;
color:black'><br clear=all style='page-break-before:always'>
</span>

<p class=TaskDetail style='margin-top:0in;margin-right:0in;margin-bottom:6.0pt;
margin-left:0in;background:white;border:none;padding:0in'>&nbsp;</p>

</div>

<h3><a name="_Toc46668415">Answers</a></h3>

<p class=MsoNormal><span style='font-size:16.0pt;line-height:115%'>Exercise 1: Working
with Clustered ColumnStore Indexes</span></p>

<p class=MsoListParagraph style='margin-left:.25in;text-indent:-.25in'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Re-
Generate a larger dataset, on the Trip_MedallionID table. Execute the code
below, also found in file: L2_02.sql.</p>

<p class=MsoListParagraph style='margin-left:.25in'>What is the effect of
adding data to the table 323,931at a time?</p>

<p class=MsoListParagraph style='margin-left:.25in'>All the data added will go
into the Delta-Store / Open RowGroup, 323,931 rows spread over 60 distributions
will average ~ 5,400 rows / distribution, which is significantly less than the
threshold of 102,400 rows to go directly to Compressed format.</p>

<p class=MsoListParagraph style='margin-left:.25in;text-indent:-.25in'>3.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Re-examine
the stats for table Trip_Medallion, using the code from step 1 above.</p>

<p class=MsoListParagraph style='margin-left:.25in'>What status’s do you see
for the RowGroups?</p>

<p class=MsoNoSpacing style='margin-left:.5in'>Closed and Open, possibly
Compressed.</p>

<p class=MsoNoSpacing style='margin-left:.5in'>Open RowGroups are available to
accept incoming data, &lt; 102,400 rows / batch / Distribution.</p>

<p class=MsoNoSpacing style='margin-left:.5in'>Closed RowGroups are waiting to
be compressed.</p>

<p class=MsoNoSpacing style='margin-left:.5in'>Closed RowGroups will be atuomtaically
compressed over time, by the system.</p>

<p class=MsoListParagraph style='margin-left:.25in'>&nbsp;</p>

<p class=MsoListParagraph style='margin-left:.25in;text-indent:-.25in'>6.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Copy
the expanded Trip_Medallion_ID table into a Partitioned table, Hashed on DateID
and also Partitioned on DateID. Examine the stats for table Trip_Part, using
the code from step 1 above.</p>

<p class=MsoListParagraph style='margin-left:.25in'>How many Open rowgroups are
there?</p>

<p class=MsoListParagraph style='margin-left:.25in'>There are 720 Open 
RowGroups  - 12 per Distribution, or 1 per Partition per Rowgroup.</p>

<p class=MsoListParagraph style='margin-left:.25in'>What is the average rows
per RowGroup? If this good or bad for performance?</p>

<p class=MsoListParagraph style='margin-left:.25in'>Average is 115,175 rows per
Open Rowgroup. This is very bad for Performance – Open Rowgroups are HEAP
versions of the table, which will perform very badly when compared to CCI
compressed data.</p>

<p class=MsoListParagraph style='margin-left:.25in'>For this dataset, is
Hashing on DateID a good idea?  </p>

<p class=MsoListParagraph style='margin-left:.25in'>DateID is a bad candidate for
a Partition Key, there are not enough rows in each Partition / Distribution.</p>

<p class=MsoListParagraph style='margin-left:.25in'>&nbsp;</p>

</div>

</body>

</html>
