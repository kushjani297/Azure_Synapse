<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=Generator content="Microsoft Word 15 (filtered)">
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:DengXian;
	panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
@font-face
	{font-family:Consolas;
	panose-1:2 11 6 9 2 2 4 3 2 4;}
@font-face
	{font-family:Cambria;
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:"Segoe UI";
	panose-1:2 11 5 2 4 2 4 2 2 3;}
@font-face
	{font-family:Tahoma;
	panose-1:2 11 6 4 3 5 4 4 2 4;}
@font-face
	{font-family:"\@DengXian";
	panose-1:2 1 6 0 3 1 1 1 1 1;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:10.0pt;
	margin-left:0in;
	line-height:115%;
	font-size:11.0pt;
	font-family:"Cambria",serif;}
h2
	{mso-style-link:"Heading 2 Char";
	margin-top:24.0pt;
	margin-right:.1in;
	margin-bottom:12.0pt;
	margin-left:0in;
	page-break-before:always;
	page-break-after:avoid;
	font-size:20.0pt;
	font-family:"Segoe UI",sans-serif;
	color:#4F81BD;
	font-weight:normal;}
h3
	{mso-style-link:"Heading 3 Char";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:12.0pt;
	margin-left:0in;
	line-height:115%;
	page-break-after:avoid;
	font-size:16.0pt;
	font-family:"Segoe UI",sans-serif;
	color:black;}
p.MsoToc2, li.MsoToc2, div.MsoToc2
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:5.0pt;
	margin-left:11.0pt;
	line-height:115%;
	font-size:11.0pt;
	font-family:"Cambria",serif;}
p.MsoToc3, li.MsoToc3, div.MsoToc3
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:5.0pt;
	margin-left:58.0pt;
	text-indent:-.25in;
	line-height:115%;
	font-size:11.0pt;
	font-family:"Cambria",serif;}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;}
p.MsoNoSpacing, li.MsoNoSpacing, div.MsoNoSpacing
	{mso-style-link:"No Spacing Char";
	margin:0in;
	font-size:11.0pt;
	font-family:"Cambria",serif;}
p.MsoListParagraph, li.MsoListParagraph, div.MsoListParagraph
	{mso-style-name:"List Paragraph\,Bullet List\,FooterText\,Procedure StepCxSpLast";
	mso-style-link:"List Paragraph Char\,Bullet List Char\,FooterText Char\,Procedure StepCxSpLast Char";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:10.0pt;
	margin-left:.5in;
	line-height:115%;
	font-size:11.0pt;
	font-family:"Cambria",serif;}
p.MsoTocHeading, li.MsoTocHeading, div.MsoTocHeading
	{margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	font-size:14.0pt;
	font-family:"Segoe UI",sans-serif;
	color:#365F91;
	font-weight:bold;}
span.Heading2Char
	{mso-style-name:"Heading 2 Char";
	mso-style-link:"Heading 2";
	font-family:"Segoe UI",sans-serif;
	color:#4F81BD;}
span.Heading3Char
	{mso-style-name:"Heading 3 Char";
	mso-style-link:"Heading 3";
	font-family:"Segoe UI",sans-serif;
	color:black;
	font-weight:bold;}
span.ListParagraphChar
	{mso-style-name:"List Paragraph Char\,Bullet List Char\,FooterText Char\,Procedure StepCxSpLast Char";
	mso-style-link:"List Paragraph\,Bullet List\,FooterText\,Procedure StepCxSpLast";
	font-family:"Cambria",serif;}
span.TaskHeadingChar
	{mso-style-name:"Task Heading Char";
	mso-style-link:"Task Heading";
	font-family:"Segoe UI",sans-serif;
	font-weight:bold;}
p.TaskHeading, li.TaskHeading, div.TaskHeading
	{mso-style-name:"Task Heading";
	mso-style-link:"Task Heading Char";
	margin-top:0in;
	margin-right:.1in;
	margin-bottom:3.0pt;
	margin-left:0in;
	line-height:115%;
	page-break-after:avoid;
	font-size:14.0pt;
	font-family:"Segoe UI",sans-serif;
	font-weight:bold;}
span.TaskNameChar
	{mso-style-name:"Task Name Char";
	mso-style-link:"Task Name";
	font-family:"Cambria",serif;
	color:black;
	font-weight:bold;}
p.TaskName, li.TaskName, div.TaskName
	{mso-style-name:"Task Name";
	mso-style-link:"Task Name Char";
	margin-top:0in;
	margin-right:.1in;
	margin-bottom:6.0pt;
	margin-left:.75in;
	text-indent:-.25in;
	line-height:115%;
	font-size:11.0pt;
	font-family:"Cambria",serif;
	color:black;
	font-weight:bold;}
span.TaskDetailChar
	{mso-style-name:"Task Detail Char";
	mso-style-link:"Task Detail";
	font-family:"Cambria",serif;
	color:black;
	font-weight:normal;}
p.TaskDetail, li.TaskDetail, div.TaskDetail
	{mso-style-name:"Task Detail";
	mso-style-link:"Task Detail Char";
	margin-top:0in;
	margin-right:.1in;
	margin-bottom:6.0pt;
	margin-left:67.5pt;
	line-height:115%;
	font-size:11.0pt;
	font-family:"Cambria",serif;
	color:black;}
span.ExerciseScenerioChar
	{mso-style-name:"Exercise Scenerio Char";
	mso-style-link:"Exercise Scenerio";
	font-family:"Cambria",serif;}
p.ExerciseScenerio, li.ExerciseScenerio, div.ExerciseScenerio
	{mso-style-name:"Exercise Scenerio";
	mso-style-link:"Exercise Scenerio Char";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:10.0pt;
	margin-left:0in;
	line-height:115%;
	font-size:11.0pt;
	font-family:"Cambria",serif;}
p.Heading31, li.Heading31, div.Heading31
	{mso-style-name:"Heading 3\.1";
	mso-style-link:"Heading 3\.1 Char";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:12.0pt;
	margin-left:0in;
	line-height:115%;
	page-break-after:avoid;
	font-size:16.0pt;
	font-family:"Segoe UI",sans-serif;
	color:black;}
span.Heading31Char
	{mso-style-name:"Heading 3\.1 Char";
	mso-style-link:"Heading 3\.1";
	font-family:"Segoe UI",sans-serif;
	color:black;
	font-weight:normal;}
span.NoSpacingChar
	{mso-style-name:"No Spacing Char";
	mso-style-link:"No Spacing";
	font-family:"Cambria",serif;}
span.normaltextrun
	{mso-style-name:normaltextrun;}
span.eop
	{mso-style-name:eop;}
p.paragraph, li.paragraph, div.paragraph
	{mso-style-name:paragraph;
	margin-right:0in;
	margin-left:0in;
	font-size:12.0pt;
	font-family:"Times New Roman",serif;}
.MsoChpDefault
	{font-size:10.0pt;
	font-family:"Calibri",sans-serif;}
.MsoPapDefault
	{margin-bottom:10.0pt;
	line-height:115%;}
 /* Page Definitions */
 @page WordSection1
	{size:8.5in 11.0in;
	margin:1.0in 1.0in 1.0in 1.0in;
	border:double windowtext 5.25pt;
	padding:24.0pt 24.0pt 24.0pt 24.0pt;}
div.WordSection1
	{page:WordSection1;}
 /* List Definitions */
 ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
-->
</style>

</head>

<body lang=EN-US link=blue vlink=purple style='word-wrap:break-word'>

<div class=WordSection1>

<p class=MsoNormal align=center style='text-align:center'><img width=624
height=226 id="Picture 13" src="M03_L01_Lab01_files/image001.png"></p>

<p class=MsoNormal align=center style='margin-bottom:0in;text-align:center'><b><span
style='font-size:22.0pt;line-height:115%'>Designing for Performance in </span></b></p>

<p class=MsoNormal align=center style='margin-bottom:0in;text-align:center'><b><span
style='font-size:22.0pt;line-height:115%'>Azure Synapse SQL Pool</span></b></p>

<p class=MsoNormal><b>Introduction</b></p>

<p class=MsoNormal>In this lab, you will work through the different table types
in Synapse SQL Pool. This lab will provide a good understanding on the
different behaviors of Round Robin, Hash and Replicated Distribution
tables.&nbsp; </p>

<p class=MsoNormal><b>Estimated Time</b></p>

<p class=MsoNormal>60 minutes</p>

<p class=MsoNormal><b>Objectives</b></p>

<p class=MsoNormal>Upon completing this lab, you will be able to: </p>

<p class=MsoListParagraph style='margin-left:39.0pt;text-indent:-21.0pt'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>Create different tables in Synapse SQL Pool</p>

<p class=MsoListParagraph style='margin-left:39.0pt;text-indent:-21.0pt'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>Understand data distribution</p>

<p class=MsoListParagraph style='margin-left:39.0pt;text-indent:-21.0pt'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>Understand the performance difference between table types</p>

<p class=MsoListParagraph style='margin-left:39.0pt;text-indent:-21.0pt'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>Understand the impact of Hash keys on performance</p>

<b><span style='font-size:11.0pt;line-height:115%;font-family:"Cambria",serif'><br
clear=all style='page-break-before:always'>
</span></b>

<p class=MsoNormal><b>&nbsp;</b></p>

<p class=MsoNormal><b>Prerequisites</b></p>

<p class=MsoListParagraph style='margin-left:.25in;text-indent:-.25in'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>An Azure Synapse SQL (created in the Create and Provision Lab)</p>

<p class=MsoListParagraph style='margin-left:.25in;text-indent:-.25in'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>Supported operating System to perform this class: Windows 10/Windows
Server 2016</p>

<p class=MsoListParagraph style='margin-left:.25in;text-indent:-.25in'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>Visual Studio 2017 or later (preferred option) or SQL Server
Management Studio 2017 or later.</p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>&nbsp;</p>

<p class=paragraph style='margin-top:0in;margin-right:0in;margin-bottom:0in;
margin-left:.25in;vertical-align:baseline'><span class=eop><span
style='font-size:10.0pt'>&nbsp;</span></span></p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#D9E2F3'>

<p class=paragraph style='margin:0in;background:#D9E2F3;vertical-align:baseline;
border:none;padding:0in'><span class=normaltextrun><b><span style='font-size:
11.0pt;font-family:"Cambria",serif;color:black'>Note:&nbsp;</span></b></span><span
class=normaltextrun><span style='font-size:11.0pt;font-family:"Cambria",serif;
color:black'>The</span></span><span style='color:black'>&nbsp;labs can be
performed using your laptop environment rather than LOD environment.</span><span
class=eop><span style='font-size:11.0pt;font-family:"Cambria",serif;color:black'>&nbsp;</span></span></p>

</div>

<p class=paragraph style='margin:0in;vertical-align:baseline'>&nbsp;</p>

<p class=paragraph style='margin:0in;vertical-align:baseline'><span
style='font-size:9.0pt;font-family:"Segoe UI",sans-serif'>&nbsp;</span></p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#D9E2F3'>

<p class=paragraph style='margin:0in;background:#D9E2F3;vertical-align:baseline;
border:none;padding:0in'><span class=normaltextrun><b><span style='font-size:
11.0pt;font-family:"Cambria",serif;color:black'>Note:</span></b></span><span
class=normaltextrun><span style='font-size:11.0pt;font-family:"Cambria",serif;
color:black'>&nbsp;</span></span><span style='color:black'>This lab expects you
to review the output from some of the queries&nbsp;and draw conclusions or
explain what you see.&nbsp;<i>The questions for you to answer are in italics.</i>&nbsp;&nbsp;&nbsp;</span></p>

<p class=paragraph style='margin:0in;background:#D9E2F3;vertical-align:baseline;
border:none;padding:0in'><span class=normaltextrun><span style='font-size:11.0pt;
font-family:"Cambria",serif;color:black'>Please note your answers, so we can go
through them at the end of the lab.</span></span><span class=eop><span
style='font-size:11.0pt;font-family:"Cambria",serif;color:black'>&nbsp;</span></span></p>

</div>

<span style='font-size:11.0pt;line-height:115%;font-family:"Cambria",serif'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoTocHeading>Table of Contents</p>

<p class=MsoToc2><a href="#_Toc46668529">Lab: Designing for Performance in
Synapse SQL<span style='color:windowtext;display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>4</span></a></p>

<p class=MsoToc3 style='text-indent:-58.0pt'><span style='font-family:"Calibri",sans-serif'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>i.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><a href="#_Toc46668530">Preparation<span style='color:windowtext;
display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>7</span></a></p>

<p class=MsoToc3 style='text-indent:-58.0pt'><span style='font-family:"Calibri",sans-serif'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>ii.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><a href="#_Toc46668531">Exercise 1: Understand Data Distribution<span
style='color:windowtext;display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>9</span></a></p>

<p class=MsoToc3 style='text-indent:-58.0pt'><span style='font-family:"Calibri",sans-serif'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>iii.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><a href="#_Toc46668532">Exercise 2: Choosing the right Hash Key<span
style='color:windowtext;display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>13</span></a></p>

<p class=MsoToc3 style='text-indent:-58.0pt'><span style='font-family:"Calibri",sans-serif'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>iv.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><a href="#_Toc46668533">Answers<span style='color:windowtext;
display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>22</span></a></p>

<p class=MsoToc3 style='text-indent:-58.0pt'><span style='font-family:"Calibri",sans-serif'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>v.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><a href="#_Toc46668534">Exercise 1: Understand Data Distribution<span
style='color:windowtext;display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>22</span></a></p>

<p class=MsoToc3 style='text-indent:-58.0pt'><span style='font-family:"Calibri",sans-serif'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>vi.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><a href="#_Toc46668535">Exercise 2: Choosing the right Hash key<span
style='color:windowtext;display:none;text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>24</span></a></p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal> </p>

<p class=MsoNormal>&nbsp;</p>

<h2><a name="_Toc46668529"></a><a name="_Toc510003826">Lab</a>: Designing for
Performance in Synapse SQL</h2>

<p class=MsoNormal>In this lab, you will create multiple tables and understand
the impact on the query performance. </p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#BDD6EE'>

<p class=MsoNormal style='background:#BDD6EE;border:none;padding:0in'><b><span
style='color:black'>Important:</span></b><span style='color:black'> Please
ensure your Synapse SQL Pool data warehouse is running at DWU 1000c before
proceeding with the preparation task. Please Resume and / or scale it up/down
if it is not running at DWU1000 c.</span></p>

<p class=MsoNormal style='background:#BDD6EE;border:none;padding:0in'><span
style='color:black'>All SQL Script files for this Lab can be located in folder <b>LabFiles\Module3\M03L01Lab01.</b></span></p>

<p class=MsoNormal style='background:#BDD6EE;border:none;padding:0in'><span
style='color:black'>All SQL Script files for this Lab are named <b>“M03_L01_Lab01.*.sql”</b></span></p>

</div>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>In this lab, you will be asked to review the Estimated or
Explain Plans for several queries. How this is done depends on which tool you
are using – Visual Studio or SSMS.</p>

<p class=MsoListParagraph style='text-indent:-.25in'><span style='font-family:
Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>In SSMS, you will use the “Display Estimated Execution Plan”
button, which will return a graphical representation of the Estimated Plan.
Note that the “EXPLAIN” keyword is commented in this case, do not include
EXPLAIN in the query you want to get the Estimated Query plan for, either
select only the query without the EXPLAIN, or comment the EXPLAIN keyword.</p>

<p class=MsoListParagraph>You <i>can </i>run the EXPLAIN in SSMS, but the XML
output is not recognized by SSMS, you will have to copy the output to a tool
that can handle XML.</p>

<p class=MsoListParagraph><img width=498 height=355 id="Picture 71"
src="M03_L01_Lab01_files/image002.jpg"></p>

<p class=MsoListParagraph>&nbsp;</p>

<p class=MsoListParagraph style='text-indent:-.25in'><span style='font-family:
Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>In Visual Studio, run the query <u>with</u> the EXPLAIN keyword.
This will generate an XML version of the estimated query plan, also known as
the ‘Explain Plan’ because it’s generated by the EXPLAIN Keyword.</p>

<p class=MsoListParagraph><img width=624 height=285 id="Picture 74"
src="M03_L01_Lab01_files/image003.png"></p>

<p class=MsoListParagraph>Visual Studio will recognize the XML, and open it in
another window, when you click on the XML in the output window.</p>

<p class=MsoListParagraph><img width=624 height=360 id="Picture 76"
src="M03_L01_Lab01_files/image004.jpg"></p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>While SSMS and Graphical plans are more familiar to many
people. Visual Studio’s processing of the XML provides a cleaner view of the
distributed query plan in many cases. The two tools are very similar in output
and usage, and in most cases, which tool to use is a personal choice, though it
is recommended to get familiar with both, to understand when there is a
meaningful difference between the two.</p>

<b><span style='font-size:16.0pt;line-height:115%;font-family:"Segoe UI",sans-serif;
color:black'><br clear=all style='page-break-before:always'>
</span></b>

<h3>&nbsp;</h3>

<h3><a name="_Toc46668530">Preparation</a></h3>

<p class=MsoNormal>We need to load the NYCTaxi default dataset for this lab.</p>

<p class=MsoNormal><b><u>Tasks.</u></b></p>

<p class=MsoListParagraph style='margin-left:.25in;text-indent:-.25in'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>In
SSMS, connect to your Synapse SQL Pool.</p>

<p class=MsoListParagraph style='margin-left:.25in;text-indent:-.25in'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Clear
out any previously created tables. Execute the code below <a name="_Hlk57816908">(script
file<b> “M03_L01_Lab01.Ex0_Step2.sql”</b>)</a>:</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#BDD6EE;margin-left:.25in;margin-right:0in'>

<p class=MsoListParagraph style='margin-left:0in;background:#BDD6EE;border:
none;padding:0in'><span style='color:black'>Script file: <b>M03_L01_Lab01.Ex0_Step2.sql</b></span></p>

</div>

<p class=MsoListParagraph style='margin-left:.25in'><a name="_Toc46063272"><img
width=515 height=107 src="M03_L01_Lab01_files/image005.png"
alt="IF object_id('Date') IS NOT NULL           DROP TABLE [Date];&#13;&#10;IF object_id('Geography') IS NOT NULL      DROP TABLE [Geography];&#13;&#10;IF object_id('HackneyLicense') IS NOT NULL DROP TABLE [HackneyLicense];&#13;&#10;IF object_id('Medallion') IS NOT NULL      DROP TABLE [Medallion];&#13;&#10;IF object_id('Time') IS NOT NULL           DROP TABLE [Time];&#13;&#10;IF object_id('Trip') IS NOT NULL           DROP TABLE [Trip];&#13;&#10;"></a></p>

<p class=MsoListParagraph style='margin-left:.25in;text-indent:-.25in'>3.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Open
and run these scripts:</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#BDD6EE;margin-left:.25in;margin-right:0in'>

<p class=MsoListParagraph style='margin-left:0in;background:#BDD6EE;border:
none;padding:0in'><span style='color:black'>Script file: <b>M03_L01_Lab01.Ex0_NY_Taxicab_Data_Set_CREATE_TABLES.sql</b></span></p>

<p class=MsoListParagraph style='margin-left:0in;background:#BDD6EE;border:
none;padding:0in'><span style='color:black'>Script file: <b>M03_L01_Lab01.Ex0_NY_Taxicab_Data_Set_DATA_LOAD.sql</b></span></p>

</div>

<p class=MsoNoSpacing><b>&nbsp;</b></p>

<p class=MsoNoSpacing>Note – the Load script will take a few minutes to
complete.</p>

<p class=MsoNoSpacing><b>&nbsp;</b></p>

<p class=MsoNoSpacing><b>&nbsp;</b></p>

<p class=MsoListParagraph style='margin-left:.25in'>&nbsp;</p>

<p class=MsoListParagraph style='margin-left:.25in'>&nbsp;</p>

<span style='font-size:11.0pt;line-height:115%;font-family:"Cambria",serif'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoListParagraph style='margin-left:.25in;text-indent:-.25in'>4.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>&nbsp;</p>

<p class=MsoListParagraph style='margin-left:.25in;text-indent:-.25in'>4.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Connect
to the SQL Pool using Visual Studio or SSMS, and execute this query to create
view vSkew. This query gives the Skew percentage as: </p>

<p class=MsoListParagraph style='margin-left:.25in'>( (Max Rows in a
Distribution – Min Rows  in a Distribution) / Max Rows in a Distribution) * 100</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#BDD6EE;margin-left:.25in;margin-right:0in'>

<p class=MsoListParagraph style='margin-left:0in;background:#BDD6EE;border:
none;padding:0in'><span style='color:black'>Script file: <b>M03_L01_Lab01.Ex0_vSkew.sql</b></span></p>

</div>

<p class=MsoListParagraph style='margin-left:.25in'><a name="_Toc46063630"><img
width=772 height=425 src="M03_L01_Lab01_files/image006.png"
alt="CREATE VIEW dbo.vSkew&#13;&#10;AS&#13;&#10;WITH TblDtls &#13;&#10;AS&#13;&#10;(&#13;&#10;SELECT	t.[name]				AS  [table_name],&#13;&#10;		nt.[distribution_id]	AS  [distribution_id],&#13;&#10;		nps.[row_count]			AS  [row_count]&#13;&#10;	FROM sys.tables t&#13;&#10;		INNER JOIN sys.pdw_table_mappings tm&#13;&#10;			ON t.[object_id] = tm.[object_id]&#13;&#10;		INNER JOIN sys.pdw_nodes_tables nt&#13;&#10;			ON tm.[physical_name] = nt.[name]&#13;&#10;		INNER JOIN sys.dm_pdw_nodes pn&#13;&#10;			ON  nt.[pdw_node_id] = pn.[pdw_node_id]&#13;&#10;		INNER JOIN sys.dm_pdw_nodes_db_partition_stats nps&#13;&#10;			ON nt.[object_id] = nps.[object_id]&#13;&#10;			AND nt.[pdw_node_id] = nps.[pdw_node_id]&#13;&#10;			AND nt.[distribution_id] = nps.[distribution_id]&#13;&#10;	WHERE pn.[type] = 'COMPUTE'&#13;&#10;)&#13;&#10;SELECT	table_name,&#13;&#10;		( ((MAX(row_count) * 1.0) - (MIN(row_count) * 1.0)) / (MAX(row_count) * 1.0) ) * 100.0 AS Skew&#13;&#10;	FROM tblDtls&#13;&#10;	GROUP BY table_name&#13;&#10;"></a></p>

<p class=MsoListParagraph style='margin-left:.25in'>&nbsp;</p>

<p class=MsoListParagraph style='margin-left:.25in'>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#BDD6EE'>

<p class=MsoNormal style='background:#BDD6EE;border:none;padding:0in'><b><span
style='color:black'>Note: </span></b><span style='color:black'>Leave Visual
Studio / SSMS open – you will be using that throughout the Lab.</span></p>

</div>

<h3 style='margin-left:.5in'><span style='font-size:11.0pt;line-height:115%;
font-family:"Cambria",serif;font-weight:normal'>&nbsp;</span></h3>

<h3 style='margin-left:.5in'><span style='font-size:11.0pt;line-height:115%;
font-family:"Cambria",serif;font-weight:normal'>&nbsp;</span></h3>

<h3><span style='font-size:11.0pt;line-height:115%;font-family:"Cambria",serif'>&nbsp;</span></h3>

<b><span style='font-size:16.0pt;line-height:115%;font-family:"Segoe UI",sans-serif;
color:black'><br clear=all style='page-break-before:always'>
</span></b>

<h3>&nbsp;</h3>

<h3><a name="_Hlk46068073"></a><a name="_Toc46668531">Exercise 1: Understand
Data Distribution</a></h3>

<p class=MsoNormal>Data in a Distributed table is split across 60
distributions, it is important to understand how the data is distributed across
the 60 distributions. This helps to identify if there is data skew, if the
selected key is a good candidate, and the potential implications for
performance.</p>

<p class=ExerciseScenerio>&nbsp;</p>

<p class=TaskHeading>Tasks</p>

<p class=TaskName style='margin-left:0in;text-indent:0in'>Create different
versions of a table, and review the data distribution</p>

<p class=MsoListParagraph style='margin-left:.25in;text-indent:-.25in'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>If
you didn’t leave Visual Studio / SSMS open, connect to your Synapse SQL Pool
database, using Visual Studio or SSMS.</p>

<p class=MsoNormal style='text-indent:.25in'>Run<b> </b>the following queries
to copy the <b>Trip table</b>, with different distributions.</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#BDD6EE;margin-left:.25in;margin-right:0in'>

<p class=MsoListParagraph style='margin-left:0in;background:#BDD6EE;border:
none;padding:0in'><span style='color:black'>Script file: <b>M03_L01_Lab01.Ex1_Step1.sql</b></span></p>

</div>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoListParagraph style='margin-left:0in'>(In this doc, the script is
split into multiple windows to make is easier to format, read and copy) </p>

<p class=MsoListParagraph style='margin-left:.25in'>&nbsp;</p>

<p class=MsoListParagraph style='margin-left:.25in'><img width=613 height=259
src="M03_L01_Lab01_files/image007.png"
alt="IF( object_id ('Trip_MedallionID')) IS NOT NULL	     DROP TABLE Trip_MedallionID&#13;&#10;IF( object_id ('Trip_MedallionID_NULL')) IS NOT NULL DROP TABLE Trip_MedallionID_NULL&#13;&#10;IF( object_id ('Trip_MedallionID_Dflt')) IS NOT NULL DROP TABLE Trip_MedallionID_Dflt&#13;&#10;IF( object_id ('Trip_RR')) IS NOT NULL		     DROP TABLE Trip_RR&#13;&#10;GO&#13;&#10;&#13;&#10;-- Copy the Trip table, HASHED on MedallionID, filtered to 323,931 rows&#13;&#10;CREATE TABLE Trip_MedallionID &#13;&#10;WITH&#13;&#10;(	DISTRIBUTION = HASH ( [MedallionID] ),&#13;&#10;	CLUSTERED COLUMNSTORE INDEX )&#13;&#10;AS &#13;&#10;SELECT *&#13;&#10;FROM [Trip]&#13;&#10;WHERE PaymentType IN ('DIS', 'UNK')&#13;&#10;"></p>

<p class=MsoListParagraph style='margin-left:.25in'><img width=459 height=627
src="M03_L01_Lab01_files/image008.png"
alt="-- Copy the filtered Trip table, HASHED on a NULLED MedallionID&#13;&#10;CREATE TABLE Trip_MedallionID_NULL &#13;&#10;WITH&#13;&#10;(	DISTRIBUTION = HASH ( [MedallionID] ),&#13;&#10;	CLUSTERED COLUMNSTORE INDEX )&#13;&#10;AS &#13;&#10;SELECT [DateID],&#13;&#10;	CAST (NULL AS [int]) AS [MedallionID],&#13;&#10;	[HackneyLicenseID],&#13;&#10;	[PickupTimeID],&#13;&#10;	[DropoffTimeID],&#13;&#10;	[PickupGeographyID],&#13;&#10;	[DropoffGeographyID],&#13;&#10;	[PickupLatitude],&#13;&#10;	[PickupLongitude],&#13;&#10;	[PickupLatLong],&#13;&#10;	[DropoffLatitude],&#13;&#10;	[DropoffLongitude],&#13;&#10;	[DropoffLatLong],&#13;&#10;	[PassengerCount],&#13;&#10;	[TripDurationSeconds],&#13;&#10;	[TripDistanceMiles],&#13;&#10;	[PaymentType],&#13;&#10;	[FareAmount],&#13;&#10;	[SurchargeAmount],&#13;&#10;	[TaxAmount],&#13;&#10;	[TipAmount],&#13;&#10;	[TollsAmount],&#13;&#10;	[TotalAmount]&#13;&#10;FROM [Trip_MedallionID];&#13;&#10;"></p>

<p class=MsoListParagraph style='margin-left:.25in'><img width=467 height=643
src="M03_L01_Lab01_files/image009.png"
alt="-- Copy the filtered Trip table, HASHED on a Default MedallionID&#13;&#10;CREATE TABLE Trip_MedallionID_Dflt &#13;&#10;WITH&#13;&#10;(	DISTRIBUTION = HASH ( [MedallionID] ),&#13;&#10;	CLUSTERED COLUMNSTORE INDEX )&#13;&#10;AS &#13;&#10;SELECT [DateID],&#13;&#10;	CAST (99 AS [int]) AS [MedallionID] ,&#13;&#10;	[HackneyLicenseID],&#13;&#10;	[PickupTimeID],&#13;&#10;	[DropoffTimeID],&#13;&#10;	[PickupGeographyID],&#13;&#10;	[DropoffGeographyID],&#13;&#10;	[PickupLatitude],&#13;&#10;	[PickupLongitude],&#13;&#10;	[PickupLatLong],&#13;&#10;	[DropoffLatitude],&#13;&#10;	[DropoffLongitude],&#13;&#10;	[DropoffLatLong],&#13;&#10;	[PassengerCount],&#13;&#10;	[TripDurationSeconds],&#13;&#10;	[TripDistanceMiles],&#13;&#10;	[PaymentType],&#13;&#10;	[FareAmount],&#13;&#10;	[SurchargeAmount],&#13;&#10;	[TaxAmount],&#13;&#10;	[TipAmount],&#13;&#10;	[TollsAmount],&#13;&#10;	[TotalAmount]&#13;&#10;FROM [Trip_MedallionID];&#13;&#10;&#13;&#10;&#13;&#10;-- Copy the Trip table, as Round_Robin distributed&#13;&#10;CREATE TABLE Trip_RR &#13;&#10;WITH&#13;&#10;(	DISTRIBUTION = ROUND_ROBIN,&#13;&#10;	CLUSTERED COLUMNSTORE INDEX)&#13;&#10;AS &#13;&#10;SELECT *&#13;&#10;FROM [Trip_MedallionID];&#13;&#10;"></p>

<p class=MsoListParagraph style='margin-left:.25in'>&nbsp;</p>

<p class=MsoListParagraph style='margin-left:.25in'>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#BDD6EE'>

<p class=MsoNormal style='background:#BDD6EE;border:none;padding:0in'><b><span
style='color:black'>Note: </span></b><span style='color:black'>We created four
different tables, three as Hash Distributed and a Round_Robin Distributed version.</span></p>

</div>

<span style='font-size:11.0pt;line-height:115%;font-family:"Cambria",serif;
color:black'><br clear=all style='page-break-before:always'>
</span>

<h3 style='margin-left:.5in'><span style='font-size:11.0pt;line-height:115%;
font-family:"Cambria",serif;font-weight:normal'>&nbsp;</span></h3>

<p class=MsoListParagraph style='margin-left:.25in;text-indent:-.25in'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Using
this template, review the statistics for the tables below.</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#BDD6EE;margin-left:.25in;margin-right:0in'>

<p class=MsoListParagraph style='margin-left:0in;background:#BDD6EE;border:
none;padding:0in'><span style='color:black'>Script file: <b>M03_L01_Lab01.Ex1_Step2.sql</b></span></p>

</div>

<p class=MsoListParagraph style='margin-left:.25in'>&nbsp;</p>

<p class=MsoListParagraph style='margin-left:.25in'><img width=247 height=100
src="M03_L01_Lab01_files/image010.png"
alt="DBCC PDW_SHOWSPACEUSED ('xxx');&#13;&#10;SELECT *&#13;&#10;FROM vSkew&#13;&#10;WHERE Table_Name = 'xxx'&#13;&#10;&#13;&#10;"></p>

<p class=MsoListParagraph style='text-indent:-.25in'><span style='font-family:
Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>Trip_MedallionID</p>

<p class=MsoListParagraph style='text-indent:-.25in'><span style='font-family:
Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>Trip_MedallionID_Null</p>

<p class=MsoListParagraph style='text-indent:-.25in'><span style='font-family:
Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>Trip_MedallionID_Dflt</p>

<p class=MsoListParagraph style='text-indent:-.25in'><span style='font-family:
Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>Trip_RR</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#BDD6EE'>

<p class=MsoListParagraph style='margin-left:0in;background:#BDD6EE;border:
none;padding:0in'><b><span style='color:black'>Note: </span></b><span
style='color:black'>Replace the ‘xxx’ in the script with the table names listed.</span></p>

<p class=MsoListParagraph style='margin-left:0in;background:#BDD6EE;border:
none;padding:0in'><span style='color:black'>WHERE Table_Name = </span><span
style='font-size:9.5pt;line-height:115%;font-family:Consolas;color:red'>'</span><span
style='color:red'>xxx</span><span style='font-size:9.5pt;line-height:115%;
font-family:Consolas;color:red'>'</span></p>

</div>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoListParagraph style='margin-left:.25in;text-indent:-.25in'><a
name="_Hlk46068158"><i>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></i><i>With the output from the previous task, answer these questions:</i></a></p>

<p class=MsoListParagraph style='margin-left:.25in'><i>Which table(s) has:</i></p>

<p class=MsoListParagraph style='text-indent:-.25in'><i>a.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></i><i>The
worst distribution?</i></p>

<p class=MsoListParagraph style='text-indent:-.25in'><i>b.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></i><i>What
is the difference between the NULL and DFLT copies?</i></p>

<p class=MsoListParagraph style='text-indent:-.25in'><i>c.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></i><i>The best distribution?</i></p>

<p class=MsoListParagraph style='margin-left:.25in;text-indent:-.25in'><a
name="_Hlk46068183"><i>4.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></i><i>Based on these results, is MedallionID (not the NULLed of
DEFAULTed versions) a good candidate to distribute this table?</i></a></p>

<p class=MsoListParagraph style='margin-left:.25in;text-indent:-.25in'><i>5.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></i><i>To
confirm whether MedallionID is a good candidate, what is the cardinality of the
data in that column? </i></p>

<p class=MsoNormal style='text-indent:.25in'><i>Note - You will need to write
the query yourself, but you’re probably going to want to use a COUNT / DISTINCT
query!</i></p>

<h3><a name="_Toc46668532">Exercise 2: Choosing the right Hash Key</a></h3>

<p class=MsoNormal>Data in a Distributed table is arranged based on a Hash Key.
The choice of the right hash key is core to performance considerations in Synapse
SQL Pool table design. A primary component of performance in SQL Pools is Data
Movement, a good or bad choice of Hash keys will directly influence the amount
of Data movement, and hence performance of your environment.</p>

<p class=ExerciseScenerio>&nbsp;</p>

<p class=TaskHeading>Tasks</p>

<p class=TaskName style='margin-left:0in;text-indent:0in'>Demonstrate different
scenarios for the 3 goals of picking a Distribution key.</p>

<p class=MsoListParagraph style='margin-left:.25in;text-indent:-.25in'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>If
you didn’t leave Visual Studio / SSMS open, connect to your Synapse SQL Pool
database, using Visual Studio or SSMS.</p>

<p class=MsoNormal><b><u>Data Movement for mismatched Hash Keys.</u></b></p>

<p class=MsoListParagraph style='margin-left:.25in;text-indent:-.25in'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Run<b>
</b>the following queries to copy the filtered Trip table, distributed on
HackneyLicenseID, and create a Hash Distributed copy of the Medallion table </p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#BDD6EE;margin-left:.25in;margin-right:0in'>

<p class=MsoListParagraph style='margin-left:0in;background:#BDD6EE;border:
none;padding:0in'><span style='color:black'>Script file: <b>M03_L01_Lab01.Ex2_Step2.sql</b></span></p>

</div>

<p class=MsoListParagraph style='margin-left:.25in'><img width=613 height=442
src="M03_L01_Lab01_files/image011.png"
alt="IF( object_id ('Trip_HackneyLicenseID')) IS NOT NULL DROP TABLE Trip_HackneyLicenseID&#13;&#10;IF( object_id ('Medallion_HD')) IS NOT NULL DROP TABLE Medallion_HD&#13;&#10;IF( object_id ('HackneyLicense_HD')) IS NOT NULL DROP TABLE HackneyLicense_HD&#13;&#10;GO&#13;&#10;&#13;&#10;-- Copy the filtered Trip table, HASHED on HackneyLicenseID&#13;&#10;CREATE TABLE Trip_HackneyLicenseID&#13;&#10;WITH ( DISTRIBUTION = HASH ( [HackneyLicenseID] ),&#13;&#10;       CLUSTERED COLUMNSTORE INDEX )&#13;&#10;AS &#13;&#10;SELECT *&#13;&#10;FROM [Trip_MedallionID];&#13;&#10;&#13;&#10;-- Create a HASH Distributed copy of the Medallion table (HD = Hash Distributed)&#13;&#10;CREATE TABLE Medallion_HD&#13;&#10;WITH ( DISTRIBUTION = HASH ( [MedallionID] ),&#13;&#10;       HEAP )&#13;&#10;AS &#13;&#10;SELECT *&#13;&#10;FROM [Medallion];&#13;&#10;&#13;&#10;-- Create a HASH Distributed copy of the HackneyLicense table (HD = Hash Distributed)&#13;&#10;CREATE TABLE HackneyLicense_HD&#13;&#10;WITH ( DISTRIBUTION = HASH ( [HackneyLicenseID] ),&#13;&#10;       HEAP )&#13;&#10;AS &#13;&#10;SELECT *&#13;&#10;FROM [HackneyLicense]&#13;&#10;&#13;&#10;&#13;&#10;&#13;&#10;&#13;&#10;"></p>

<p class=MsoListParagraph style='margin-left:.25in;text-indent:-.25in'>3.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Review
the Explain / Estimated query plan for these queries (see the Intro section of
this document on how to do that, if needed).</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#BDD6EE;margin-left:.25in;margin-right:0in'>

<p class=MsoListParagraph style='margin-left:0in;background:#BDD6EE;border:
none;padding:0in'><span style='color:black'>Script file: <b>M03_L01_Lab01.Ex2_Step3.sql</b></span></p>

</div>

<p class=MsoListParagraph style='margin-left:.25in'>&nbsp;</p>

<p class=MsoListParagraph style='margin-left:.25in'><img width=243 height=197
src="M03_L01_Lab01_files/image012.png"
alt="EXPLAIN&#13;&#10;SELECT *&#13;&#10;FROM Trip_MedallionID t&#13;&#10;INNER JOIN Medallion_HD m&#13;&#10;ON t.MedallionID = m.MedallionID&#13;&#10;&#13;&#10;EXPLAIN&#13;&#10;SELECT *&#13;&#10;FROM Trip_HackneyLicenseID t&#13;&#10;INNER JOIN Medallion_HD m&#13;&#10;ON t.MedallionID = m.MedallionID&#13;&#10;"></p>

<p class=MsoListParagraph style='margin-left:.25in'><i>&nbsp;</i></p>

<p class=MsoListParagraph style='margin-left:.25in;text-indent:-.25in'><i>4.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></i><i>Which
query incurs Data Movement, and why?</i></p>

<p class=MsoListParagraph style='margin-left:.25in'>&nbsp;</p>

<p class=MsoNormal><b><u>Balanced execution, with Skewed Data.</u></b></p>

<p class=MsoListParagraph style='margin-left:.25in;text-indent:-.25in'>5.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Run<b>
</b>the following queries to copy the Trip table and add in a second copy of
the data with skewed data (from Exercise 1, step 2 above).</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#BDD6EE;margin-left:.25in;margin-right:0in'>

<p class=MsoListParagraph style='margin-left:0in;background:#BDD6EE;border:
none;padding:0in'><span style='color:black'>Script file: <b>M03_L01_Lab01.Ex2_Step5.sql</b></span></p>

</div>

<p class=MsoListParagraph style='margin-left:.25in'>&nbsp;</p>

<p class=MsoListParagraph style='margin-left:.25in'><img width=683 height=267
src="M03_L01_Lab01_files/image013.png"
alt="IF( object_id ('Trip_MedallionID_Skewed')) IS NOT NULL DROP TABLE Trip_MedallionID_Skewed&#13;&#10;GO&#13;&#10;&#13;&#10;-- Copy the Trip table, HASHED on MedallionID, combined with the copy with NULL in the HASH key&#13;&#10;CREATE TABLE Trip_MedallionID_Skewed&#13;&#10;WITH ( DISTRIBUTION = HASH ( [MedallionID] ),&#13;&#10;       CLUSTERED COLUMNSTORE INDEX )&#13;&#10;AS &#13;&#10;SELECT *&#13;&#10;FROM [Trip_MedallionID]&#13;&#10;UNION&#13;&#10;SELECT *&#13;&#10;FROM [Trip_MedallionID_NULL]&#13;&#10;"></p>

<p class=MsoListParagraph style='margin-left:.25in'>&nbsp;</p>

<p class=MsoListParagraph style='margin-left:.25in;text-indent:-.25in'>6.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Review
the skew in the table just created. Distribution 1 has ~ 323K rows, and Skew is
&gt; 50%.</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#BDD6EE;margin-left:.25in;margin-right:0in'>

<p class=MsoListParagraph style='margin-left:0in;background:#BDD6EE;border:
none;padding:0in'><span style='color:black'>Script file: <b>M03_L01_Lab01.Ex2_Step6.sql</b></span></p>

</div>

<p class=MsoListParagraph style='margin-left:.25in'>&nbsp;</p>

<p class=MsoListParagraph style='margin-left:.25in'><img width=376 height=100
src="M03_L01_Lab01_files/image014.png"
alt="DBCC PDW_SHOWSPACEUSED ('Trip_MedallionID_Skewed');&#13;&#10;&#13;&#10;SELECT *&#13;&#10;FROM vSkew&#13;&#10;WHERE Table_Name = 'Trip_MedallionID_Skewed'&#13;&#10;&#13;&#10;"></p>

<p class=MsoListParagraph style='margin-left:.25in'>&nbsp;</p>

<p class=MsoListParagraph style='margin-left:.25in;text-indent:-.25in'>7.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Execute
this query against the skewed table. <b>NOTE</b> there is no EXPLAIN, we want
to see the actual execution statistics. The Label option will be used in the
next steps, to retrieve the query execution statistics.</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#BDD6EE;margin-left:.25in;margin-right:0in'>

<p class=MsoListParagraph style='margin-left:0in;background:#BDD6EE;border:
none;padding:0in'><span style='color:black'>Script file: <b>M03_L01_Lab01.Ex2_Step7.sql</b></span></p>

</div>

<p class=MsoListParagraph style='margin-left:.25in'>&nbsp;</p>

<p class=MsoListParagraph style='margin-left:.25in'><img width=488 height=149
src="M03_L01_Lab01_files/image015.png"
alt="SELECT t.DateID,&#13;&#10;       t.HackneyLicenseID,&#13;&#10;       SUM(t.[TripDistanceMiles]) AS MilesDriven&#13;&#10;FROM Trip_MedallionID_Skewed t&#13;&#10;WHERE MedallionID IN (Select MedallionID FROM [dbo].[Medallion_HD])&#13;&#10;GROUP BY t.DateID,&#13;&#10;         t.HackneyLicenseID&#13;&#10;OPTION (Label = 'Skewed Data Query')&#13;&#10;"></p>

<span style='font-size:11.0pt;line-height:115%;font-family:"Cambria",serif'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoListParagraph style='margin-left:.25in'>&nbsp;</p>

<p class=MsoListParagraph style='margin-left:.25in;text-indent:-.25in'>8.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Capture
the execution statistics with these queries.</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#BDD6EE;margin-left:.25in;margin-right:0in'>

<p class=MsoListParagraph style='margin-left:0in;background:#BDD6EE;border:
none;padding:0in'><span style='color:black'>Script file: <b>M03_L01_Lab01.Ex2_Step8.sql</b></span></p>

</div>

<p class=MsoListParagraph style='margin-left:.25in'>&nbsp;</p>

<p class=MsoListParagraph style='margin-left:.25in'><img width=743 height=554
src="M03_L01_Lab01_files/image016.png"
alt="DECLARE @Label		VARCHAR(64) = 'Skewed Data Query' -- The label value from the previous query&#13;&#10;&#13;&#10;DECLARE @QID		VARCHAR(64)&#13;&#10;SELECT @QID = MAX(request_id)&#13;&#10;FROM sys.dm_pdw_exec_requests&#13;&#10;WHERE [label] = @Label &#13;&#10; AND  [command] NOT LIKE '%sys.dm_pdw_exec_requests%' -- Dont return this query&#13;&#10;&#13;&#10;-- EXEC_REQUESTS&#13;&#10;SELECT *&#13;&#10;FROM sys.dm_pdw_exec_requests &#13;&#10;WHERE request_id = @QID&#13;&#10;&#13;&#10;-- REQUEST_STEPS&#13;&#10;SELECT *&#13;&#10;FROM sys.dm_pdw_request_steps&#13;&#10;WHERE request_id = @QID&#13;&#10;&#13;&#10;-- DMS Workers&#13;&#10;SELECT *&#13;&#10;FROM sys.dm_pdw_dms_workers&#13;&#10;WHERE request_id = @QID&#13;&#10; AND  step_index = 2&#13;&#10;ORDER BY [type], distribution_id&#13;&#10;&#13;&#10;&#13;&#10;DBCC PDW_SHOWSPACEUSED ('Trip_MedallionID_Skewed');&#13;&#10;"></p>

<span style='font-size:11.0pt;line-height:115%;font-family:"Cambria",serif'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoListParagraph style='margin-left:.25in'>&nbsp;</p>

<p class=MsoListParagraph style='margin-left:.25in'>&nbsp;</p>

<p class=MsoListParagraph style='margin-left:.25in;text-indent:-.25in'>9.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Review
the output:</p>

<p class=MsoListParagraph style='margin-left:0in'><img width=623 height=329
id="Picture 5" src="M03_L01_Lab01_files/image017.jpg"></p>

<p class=MsoListParagraph style='text-indent:-.25in'>(1)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span>The ‘Label’ is visible in the output from the dm_pdw_exec_requests
query.</p>

<p class=MsoListParagraph style='text-indent:-.25in'>(2)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span>The output from the dm_pdw_request_steps are the Distributed query
steps. The stats in these steps should be very close to the EXPLAIN plan
output. Step #2 is a Shuffle Move</p>

<p class=MsoListParagraph style='text-indent:-.25in'>(3)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span>The output from dm_pdw_dms_workers reports the data processed
(HASH_READER processes) from each Distribution. Review these values to check
they are fairly evenly spread across all distributions. </p>

<p class=MsoListParagraph style='text-indent:-.25in'>(4)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span>The output from the DBCC PDW_SHOWSPACEUSED shows 329, 895 rows in
Distribution #1, but the excess rows are not reflected in the DMS Workers
output above.</p>

<p class=MsoNormal style='margin-left:.25in'>This indicates that the Execution
is balanced, even though the data is skewed.</p>

<p class=MsoNormal style='margin-left:.25in'>&nbsp;</p>

<p class=MsoListParagraph>&nbsp;</p>

<p class=MsoNormal>&nbsp;</p>

<b><u><span style='font-size:11.0pt;line-height:115%;font-family:"Cambria",serif'><br
clear=all style='page-break-before:always'>
</span></u></b>

<p class=MsoNormal><b><u><span style='text-decoration:none'>&nbsp;</span></u></b></p>

<p class=MsoNormal><b><u>Round-Robin Distribution and Data Movement.</u></b></p>

<p class=MsoListParagraph style='margin-left:.25in;text-indent:-.25in'>10.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span>Create a Replicated
copy of the Geography table.</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#BDD6EE;margin-left:.25in;margin-right:0in'>

<p class=MsoListParagraph style='margin-left:0in;background:#BDD6EE;border:
none;padding:0in'><span style='color:black'>Script file: <b>M03_L01_Lab01.Ex2_Step10.sql</b></span></p>

</div>

<p class=MsoListParagraph style='margin-left:.25in'>&nbsp;</p>

<p class=MsoListParagraph style='margin-left:.25in'><img width=531 height=213
src="M03_L01_Lab01_files/image018.png"
alt="IF( object_id ('Geography_Repl')) IS NOT NULL	DROP TABLE Geography_Repl&#13;&#10;GO&#13;&#10;&#13;&#10;CREATE TABLE Geography_Repl &#13;&#10;WITH (DISTRIBUTION = REPLICATE,&#13;&#10;      HEAP )&#13;&#10;AS&#13;&#10;SELECT *&#13;&#10;FROM [dbo].[Geography]&#13;&#10;&#13;&#10;-- Force the Replicated table into cache&#13;&#10;SELECT TOP 1 *&#13;&#10;FROM Geography_Repl &#13;&#10;&#13;&#10;&#13;&#10;"></p>

<p class=MsoListParagraph style='margin-left:.25in'>&nbsp;</p>

<p class=MsoListParagraph style='margin-left:.25in;text-indent:-.25in'>11.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span>Review the Explain /
Estimated query plan for this query.</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#BDD6EE;margin-left:.25in;margin-right:0in'>

<p class=MsoListParagraph style='margin-left:0in;background:#BDD6EE;border:
none;padding:0in'><span style='color:black'>Script file: <b>M03_L01_Lab01.Ex2_Step11.sql</b></span></p>

</div>

<p class=MsoListParagraph style='margin-left:.25in'>&nbsp;</p>

<p class=MsoListParagraph style='margin-left:.25in'><i>What data moves?</i></p>

<p class=MsoListParagraph style='margin-left:.25in'><img width=313 height=98
src="M03_L01_Lab01_files/image019.png"
alt="EXPLAIN&#13;&#10;SELECT *&#13;&#10;FROM [dbo].[Trip_RR] t&#13;&#10;INNER JOIN [dbo].[Geography] g&#13;&#10;ON t.[PickupGeographyID] = g.[GeographyID]&#13;&#10;&#13;&#10;"></p>

<span style='font-size:11.0pt;line-height:115%;font-family:"Cambria",serif'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoListParagraph style='margin-left:.25in'>&nbsp;</p>

<p class=MsoListParagraph style='margin-left:.25in;text-indent:-.25in'>12.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span>Add a label to the
query (<span style='font-size:9.5pt;line-height:115%;font-family:Consolas;
color:blue;background:lightgrey'>OPTION </span><span style='font-size:9.5pt;
line-height:115%;font-family:Consolas;color:gray;background:lightgrey'>(</span><span
style='font-size:9.5pt;line-height:115%;font-family:Consolas;color:blue;
background:lightgrey'>Label</span><span style='font-size:9.5pt;line-height:
115%;font-family:Consolas;color:black;background:lightgrey'> </span><span
style='font-size:9.5pt;line-height:115%;font-family:Consolas;color:gray;
background:lightgrey'>=</span><span style='font-size:9.5pt;line-height:115%;
font-family:Consolas;color:black;background:lightgrey'> </span><span
style='font-size:9.5pt;line-height:115%;font-family:Consolas;color:red;
background:lightgrey'>'RR Query 1'</span><span style='font-size:9.5pt;
line-height:115%;font-family:Consolas;color:gray;background:lightgrey'>)</span>
), execute the query (without the EXPLAIN), then check the ‘Request Steps’
query stats actually match the Estimated / Explain plan.</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#BDD6EE;margin-left:.25in;margin-right:0in'>

<p class=MsoListParagraph style='margin-left:0in;background:#BDD6EE;border:
none;padding:0in'><span style='color:black'>Script file: <b>M03_L01_Lab01.Ex2_Step12.sql</b></span></p>

</div>

<p class=MsoListParagraph style='margin-left:.25in'><img width=694 height=593
src="M03_L01_Lab01_files/image020.png"
alt="SELECT *&#13;&#10;FROM [dbo].[Trip_RR] t&#13;&#10;INNER JOIN [dbo].[Geography] g&#13;&#10;ON t.[PickupGeographyID] = g.[GeographyID]&#13;&#10;OPTION (Label = 'RR Query 1')&#13;&#10;&#13;&#10;&#13;&#10;&#13;&#10;&#13;&#10;&#13;&#10;DECLARE @Label		VARCHAR(64) = 'RR Query 1' -- The label value from the previous query&#13;&#10;&#13;&#10;DECLARE @QID		VARCHAR(64)&#13;&#10;SELECT @QID = MAX(request_id)&#13;&#10;FROM sys.dm_pdw_exec_requests&#13;&#10;WHERE [label] = @Label &#13;&#10; AND  [command] NOT LIKE '%sys.dm_pdw_exec_requests%' -- Dont return this query&#13;&#10;&#13;&#10;-- EXEC_REQUESTS&#13;&#10;SELECT *&#13;&#10;FROM sys.dm_pdw_exec_requests &#13;&#10;WHERE request_id = @QID&#13;&#10;&#13;&#10;-- REQUEST_STEPS&#13;&#10;SELECT *&#13;&#10;FROM sys.dm_pdw_request_steps&#13;&#10;WHERE request_id = @QID&#13;&#10;&#13;&#10;-- DMS Workers&#13;&#10;SELECT *&#13;&#10;FROM sys.dm_pdw_dms_workers&#13;&#10;WHERE request_id = @QID&#13;&#10; AND  step_index = 2&#13;&#10;ORDER BY [type], distribution_id&#13;&#10;&#13;&#10;&#13;&#10;&#13;&#10;"></p>

<span style='font-size:11.0pt;line-height:115%;font-family:"Cambria",serif'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoListParagraph style='margin-left:.25in'>&nbsp;</p>

<p class=MsoListParagraph style='margin-left:.25in'>&nbsp;</p>

<p class=MsoListParagraph style='margin-left:.25in;text-indent:-.25in'>13.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span>Review the Explain /
Estimated query plan for this query – note that this is JOINing to the <b>Replicated</b>
copy of the Geography table.</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#BDD6EE;margin-left:.25in;margin-right:0in'>

<p class=MsoListParagraph style='margin-left:0in;background:#BDD6EE;border:
none;padding:0in'><span style='color:black'>Script file: <b>M03_L01_Lab01.Ex2_Step13.sql</b></span></p>

</div>

<p class=MsoListParagraph style='margin-left:.25in'><i>What data moves? </i></p>

<p class=MsoListParagraph style='margin-left:.25in'><img width=313 height=98
src="M03_L01_Lab01_files/image021.png"
alt="EXPLAIN&#13;&#10;SELECT *&#13;&#10;FROM [dbo].[Trip_RR] t&#13;&#10;INNER JOIN [dbo].[Geography_Repl] g&#13;&#10;ON t.[PickupGeographyID] = g.[GeographyID]&#13;&#10;&#13;&#10;"></p>

<span style='font-size:11.0pt;line-height:115%;font-family:"Cambria",serif'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoListParagraph style='margin-left:.25in'>&nbsp;</p>

<p class=MsoListParagraph style='margin-left:.25in'>&nbsp;</p>

<p class=MsoListParagraph>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#BDD6EE;margin-left:0in;margin-right:.1in'>

<p class=TaskDetail style='margin-top:0in;margin-right:0in;margin-bottom:6.0pt;
margin-left:0in;background:#BDD6EE;border:none;padding:0in'><b>Important:</b>
Please pause your Synapse SQL Pool upon completing this lab. Do resume the SQL
Pool when you start working with the exercises. This is to prevent from
reaching the credit limit throughout the workshop.</p>

</div>

<p class=MsoListParagraph>&nbsp;</p>

<p class=MsoNormal>&nbsp;</p>

<span style='font-size:11.0pt;line-height:115%;font-family:"Cambria",serif'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoNormal><a name="_Toc46668533"><b><span style='font-size:16.0pt;
line-height:115%;font-family:"Segoe UI",sans-serif;color:black'>&nbsp;</span></b></a></p>

<h3>Answers</h3>

<p class=Heading31><a name="_Toc46668534">Exercise 1: Understand Data
Distribution</a></p>

<p class=MsoListParagraph style='margin-left:.25in;text-indent:-.25in'>4.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Using
the above as a template, review the statistics for </p>

<p class=MsoListParagraph style='text-indent:-.25in'><span style='font-family:
Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>Trip_MedallionID</p>

<p class=MsoListParagraph style='text-indent:-.25in'><span style='font-family:
Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>Trip_MedallionID_Null</p>

<p class=MsoListParagraph style='text-indent:-.25in'><span style='font-family:
Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>Trip_MedallionID_Dflt</p>

<p class=MsoListParagraph style='text-indent:-.25in'><span style='font-family:
Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>Trip_RR</p>

<p class=MsoListParagraph style='margin-left:.25in'><img width=369 height=311
src="M03_L01_Lab01_files/image022.png"
alt="DBCC PDW_SHOWSPACEUSED ('Trip_MedallionID');&#13;&#10;SELECT *&#13;&#10;FROM vSkew&#13;&#10;WHERE Table_Name = 'Trip_MedallionID';&#13;&#10;&#13;&#10;DBCC PDW_SHOWSPACEUSED ('Trip_MedallionID_NULL');&#13;&#10;SELECT *&#13;&#10;FROM vSkew&#13;&#10;WHERE Table_Name = 'Trip_MedallionID_NULL';&#13;&#10;&#13;&#10;DBCC PDW_SHOWSPACEUSED ('Trip_MedallionID_Dflt');&#13;&#10;SELECT *&#13;&#10;FROM vSkew&#13;&#10;WHERE Table_Name = 'Trip_MedallionID_Dflt';&#13;&#10;&#13;&#10;DBCC PDW_SHOWSPACEUSED ('Trip_RR');&#13;&#10;SELECT *&#13;&#10;FROM vSkew&#13;&#10;WHERE Table_Name = 'Trip_RR';&#13;&#10;"></p>

<p class=MsoListParagraph style='margin-left:.25in;text-indent:-.25in'>5.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>With
the output from the previous task, answer these questions:</p>

<p class=MsoListParagraph style='margin-left:.25in'>Which table(s) has:</p>

<p class=MsoListParagraph style='text-indent:-.25in'>a.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>The worst distribution?</p>

<p class=MsoListParagraph>Trip_Medallion_NULL and Trip_Medallion_Dflt, both
tables have 100% Skew. </p>

<p class=MsoListParagraph>This is because all the data is in a single
distribution. </p>

<p class=MsoListParagraph style='text-indent:-.25in'>b.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>What is the difference between the NULL and DFLT copies?</p>

<p class=MsoListParagraph>The data is in a different Distribution. For NULL,
all the data is in distribution 1, for Dflt, all data is in another
distribution.</p>

<p class=MsoListParagraph style='text-indent:-.25in'>c.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>The best distribution?</p>

<p class=MsoListParagraph>Both Trip_MedallionID and Trip_RR have very low Skew,
from a purely Distribution perspective, there is little to choose between the
two versions. In general, a Hash-Distributed table is better than a Round Robin
Distributed table, but the question was only asking about Distribution.</p>

<p class=MsoListParagraph style='margin-left:.25in;text-indent:-.25in'>6.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Based
on these results, is MedallionID a good candidate to distribute this table?</p>

<p class=MsoListParagraph style='margin-left:.25in'>Yes – the distribution is
even, with MedallionID as the Hash Key, though, we don’t have any information
on query patterns, so we can’t tell if it is a good choice for JOINs.</p>

<p class=MsoListParagraph style='margin-left:.25in;text-indent:-.25in'>5.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>To
confirm whether MedallionID is a good candidate, what is the cardinality of the
data in that column?</p>

<p class=MsoListParagraph style='margin-left:.25in'><img width=278 height=57
src="M03_L01_Lab01_files/image023.png"
alt="SELECT COUNT(DISTINCT(MedallionID) ) &#13;&#10;FROM Trip_MedallionID&#13;&#10;"></p>

<p class=MsoListParagraph style='text-indent:-.25in'><span style='font-family:
Wingdings'>Ø<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span>13,000
– this is more than the recommended minimum count of 600 (60 Distribution *
10). From that perspective, this is a good candidate.</p>

<span style='font-size:11.0pt;line-height:115%;font-family:"Cambria",serif'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoListParagraph style='margin-left:.25in'>&nbsp;</p>

<p class=Heading31><a name="_Toc46668535">Exercise 2: Choosing the right Hash
key</a></p>

<p class=MsoListParagraph style='margin-left:.25in;text-indent:-.25in'>5.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Which
query incurs Data Movement, and why?</p>

<p class=MsoListParagraph style='margin-left:.25in'><img width=243 height=197
src="M03_L01_Lab01_files/image024.png"
alt="EXPLAIN&#13;&#10;SELECT *&#13;&#10;FROM Trip_MedallionID t&#13;&#10;INNER JOIN Medallion m&#13;&#10;ON t.MedallionID = m.MedallionID&#13;&#10;&#13;&#10;EXPLAIN&#13;&#10;SELECT *&#13;&#10;FROM Trip_HackneyLicenseID t&#13;&#10;INNER JOIN Medallion m&#13;&#10;ON t.MedallionID = m.MedallionID&#13;&#10;"></p>

<p class=MsoListParagraph style='margin-left:.25in'>The query with table
Trip_HackneyLicenseID has a Shuffle move, this move re-orders the data in
Trip_HackneyLicenseID, to line up with the data in the Medallion table. In this
case, moving data from the Medallion table can’t satisfy the JOIN – that table
is already distributed on the MedallionID column.</p>

<p class=MsoListParagraph style='margin-left:.25in;text-indent:-.25in'>12.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span>Review the Explain /
Estimated query plan for this query. What data moves?</p>

<p class=MsoListParagraph style='margin-left:.25in'>The data from Trip_RR is
shuffle moved. Because this table is effectively randomized, it must be
re-distributed on the appropriate Hash key (PickupGeographyID) before the data
can be JOINed.</p>

<p class=MsoListParagraph style='margin-left:.25in;text-indent:-.25in'>13.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span>Review the Explain /
Estimated query plan for this query – note that this is JOINing to the
Replicated copy of the Geography table. What data moves?</p>

<p class=MsoListParagraph style='margin-left:.25in'>None. Because the RR table
is JOINed to a Distributed table, no movement is necessary.</p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoListParagraph style='margin-left:.25in'>&nbsp;</p>

<p class=MsoNormal>&nbsp;</p>

</div>

</body>

</html>
